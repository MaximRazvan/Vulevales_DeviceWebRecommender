<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recomandări Dispozitive Electronice</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  
  <style>
    /* Definire variabile CSS pentru culori și umbre pentru consistență și ușurință în modificare */
    :root {
      /* TEMATICA: Culorile din codul anterior (Portocaliu, Gri, Roșu) */
      --primary-color: #FF8C00; /* Portocaliu vibrant - pentru acțiuni primare, highlight-uri (inclusiv titlul H1) */
      --secondary-color: #555555; /* Gri închis - pentru acțiuni secundare, titluri secțiuni */
      --accent-color: #f44336; /* Roșu - pentru acțiuni de avertizare/ștertere, error messages */
      --neutral-dark: #333333; /* Gri foarte închis - pentru fundaluri întunecate (header, footer) */
      --neutral-light: #c0c0c0; /* Gri mediu - pentru fundalul principal al paginii */
      --card-bg: #e0e0e0; /* Gri deschis - pentru fundalul cardurilor, modalelor */
      --input-bg: #f0f0f0; /* Gri foarte deschis - pentru fundalul câmpurilor de input */
      --text-dark: var(--neutral-dark); /* Alias pentru gri închis */
      --text-light: #ffffff; /* Alb - pentru text pe fundal întunecat */
      --border-color: #a0a0a0; /* Gri mediu - pentru borduri */
      --favorite-color-base: #FFB066; /* Portocaliu deschis - pentru butonul de favorite */
      --favorite-color-active: #FF9933; /* Portocaliu mediu - pentru starea "favoritat" și hover */

      --shadow-light: rgba(0, 0, 0, 0.08); /* Umbra ușoară */
      --shadow-medium: rgba(0, 0, 0, 0.15); /* Umbra medie */
    }

    body {
      font-family: 'Roboto', sans-serif; /* cite: 2 */
      margin: 0; /* cite: 2 */
      padding: 0; /* cite: 2 */
      background-color: var(--neutral-light); /* Fundal gri mediu */ /* cite: 2 */
      color: var(--text-dark); /* Text gri închis */ /* cite: 2 */
      line-height: 1.6; /* cite: 2 */
    }

    header {
      background-color: var(--neutral-dark); /* Fundal gri închis */ /* cite: 2 */
      padding: 1.5em 1em; /* Mai mult padding vertical */ /* cite: 2 */
      color: var(--text-light); /* Text alb */ /* cite: 2 */
      text-align: center; /* cite: 2 */
      position: relative; /* Necesar pentru poziționarea absolută a status-ului */ /* cite: 2 */
      box-shadow: 0 4px 10px var(--shadow-medium); /* Adaugă adâncime header-ului */ /* cite: 2 */
      display: flex; /* cite: 2 */
      flex-direction: column; /* Stivuiește elementele pe verticală */ /* cite: 2 */
      align-items: center; /* cite: 2 */
      gap: 1.5em; /* Spațiu între elementele din header */ /* cite: 2 */
    }
    header a {
        color: inherit; /* cite: 2 */
        text-decoration: none; /* cite: 2 */
    }
    header a:hover {
         text-decoration: underline; /* cite: 2 */
    }


    header h1 {
        font-family: 'Poppins', sans-serif; /* Font impactant pentru titlu */ /* cite: 2 */
        margin: 0; /* Elimină marginile implicite */ /* cite: 2 */
        font-size: 2.8em; /* Titlu mai mare */ /* cite: 2 */
        color: var(--primary-color); /* Culoare portocalie pentru titlu */ /* cite: 2 */
        letter-spacing: -0.03em; /* Spațiere ușor mai strânsă a literelor */ /* cite: 2 */
    }

    /* Container pentru status utilizator și buton logout în colțul dreapta sus */
    .header-top-right-status {
        position: absolute;
        top: 15px; /* Ajustează distanța de sus */
        right: 15px; /* Ajustează distanța de dreapta */
        display: flex;
        align-items: center;
        gap: 10px; /* Spațiu între butonul status și butonul logout */
        z-index: 10; /* Asigură că este deasupra altor elemente */
    }

    /* Stil pentru butonul care afișează numele și rolul utilizatorului */
    #userStatusButton {
        background-color: var(--primary-color); /* Fundal Portocaliu */
        color: var(--text-light); /* Text Alb */
        padding: 8px 15px; /* Padding intern */
        border: none;
        border-radius: 20px; /* Margini rotunjite */
        cursor: default; /* Nu are comportament de buton interactiv (doar afișează info) */
        font-size: 1em;
        font-weight: 500;
        transition: none; /* Fără tranziție la hover */
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15); /* Umbră subtilă */
        text-transform: none; /* Nu majuscule */
        letter-spacing: normal;
        display: none; /* Ascuns implicit, controlat de JS */
    }

    /* NEW: Container for top-left buttons */
    .header-top-left-actions {
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 10;
    }


    /* Container vechi pentru butoanele generale (modificat) */
    .header-actions {
        display: flex; /* cite: 2 */
        justify-content: center; /* Centrează butoanele */ /* cite: 2 */
        align-items: center; /* cite: 2 */
        width: 100%; /* Ocupă lățimea completă */ /* cite: 2 */
        flex-wrap: wrap; /* Permite înfășurarea pe ecrane mici */ /* cite: 2 */
        gap: 1em; /* Spațiu între butoane */ /* cite: 2 */
        /* Poziționarea și display-ul sunt acum separate de status */
    }

    /* #authStatus nu mai este necesar, eliminat */

    #loginButton, #logoutButton, #addProductButton, #viewFavoritesButton, #viewStatsButton {
      padding: 12px 22px; /* Padding generos */ /* cite: 2 */
      border: none; /* cite: 2 */
      border-radius: 25px; /* Butoane rotunde tip "pastilă" */ /* cite: 2 */
      cursor: pointer; /* cite: 2 */
      font-size: 1.05em; /* cite: 2 */
      font-weight: 600; /* cite: 2 */
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; /* Tranziții pentru hover */ /* cite: 2 */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Umbră subtilă pentru butoane */ /* cite: 2 */
      text-transform: uppercase; /* Text cu majuscule */ /* cite: 2 */
      letter-spacing: 0.05em; /* Spațiere a literelor */ /* cite: 2 */
      color: var(--text-light); /* Text alb pe butoane colorate */ /* cite: 2 */
    }

    #loginButton {
        background-color: var(--secondary-color); /* Buton Login/Register - Gri închis */ /* cite: 2 */
    }

    #loginButton:hover {
        background-color: #444444; /* Nuanță mai închisă la hover */ /* cite: 2 */
        transform: translateY(-3px); /* Efect de ridicare */ /* cite: 2 */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* Umbră mai pronunțată */ /* cite: 2 */
    }

    #logoutButton {
        /* Stilul butonului logout copiază stilul butonului status, dar cu accent-color */
        background-color: var(--accent-color); /* Buton Logout - Roșu */
        color: var(--text-light); /* Text Alb */
        padding: 8px 15px; /* Padding intern */
        border: none;
        border-radius: 20px; /* Margini rotunjite */
        font-size: 1em;
        font-weight: 500;
        transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        text-transform: none; /* Nu majuscule */
        letter-spacing: normal;
        cursor: pointer;
        display: none; /* Ascuns implicit, controlat de JS */
    }

    #logoutButton:hover {
        background-color: #c82333; /* Nuanță mai închisă la hover */ /* cite: 2 */
        transform: translateY(-3px); /* cite: 2 */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* cite: 2 */
    }


    #addProductButton {
        background-color: var(--primary-color); /* Buton Adaugă Produs - Portocaliu */ /* cite: 2 */
        display: none; /* Ascuns implicit, controlat de JS */ /* cite: 2 */
    }

    #addProductButton:hover {
        background-color: #E07B00; /* Nuanță mai închisă la hover */ /* cite: 2 */
        transform: translateY(-3px); /* cite: 2 */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* cite: 2 */
    }

    #viewFavoritesButton { /* Stil pentru butonul de favorite */
        background-color: var(--favorite-color-base); /* Portocaliu deschis pentru favorite */ /* cite: 2 */
        color: var(--text-dark); /* Text gri închis pe fundal portocaliu deschis */ /* cite: 2 */
        display: none; /* Ascuns implicit, controlat de JS */ /* cite: 2 */
    }

    #viewFavoritesButton:hover {
        background-color: var(--favorite-color-active); /* Portocaliu mediu la hover */ /* cite: 2 */
        transform: translateY(-3px); /* cite: 2 */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* cite: 2 */
    }

    #viewStatsButton { /* Style for the View Stats button */
        background-color: var(--accent-color); /* Make it red */
        color: var(--text-light);
    }

    #viewStatsButton:hover {
        background-color: #c82333; /* Darker red on hover */
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }


    /* Căutare și Filtre */
    #searchInput {
      padding: 0.9em 1.5em; /* Mai mult padding */ /* cite: 2 */
      border: 1px solid var(--border-color); /* Bordură gri mediu */ /* cite: 2 */
      border-radius: 25px; /* Formă de pastilă */ /* cite: 2 */
      font-size: 1.05em; /* cite: 2 */
      width: 90%; /* Ocupă mai multă lățime */ /* cite: 2 */
      max-width: 600px; /* Lățime maximă */ /* cite: 2 */
      box-sizing: border-box; /* Include padding-ul în lățime */ /* cite: 2 */
      transition: border-color 0.3s ease, box-shadow 0.3s ease; /* cite: 2 */
      background-color: var(--input-bg); /* Fundal gri foarte deschis */ /* cite: 2 */
      color: var(--text-dark); /* Text gri închis */ /* cite: 2 */
    }

    #searchInput::placeholder {
        color: #666; /* Culoare placeholder ușor mai închisă */ /* cite: 2 */
    }

    #searchInput:focus {
      border-color: var(--secondary-color); /* Bordură focus gri închis */ /* cite: 2 */
      outline: none; /* Elimină outline-ul default */ /* cite: 2 */
      box-shadow: 0 0 0 4px rgba(85, 85, 85, 0.3); /* Inel de focus mai moale (rgba din --secondary-color) */ /* cite: 2 */
    }

    #filters {
      display: flex; /* cite: 2 */
      flex-wrap: wrap; /* cite: 2 */
      justify-content: center; /* cite: 2 */
      gap: 1.2em; /* Spațiu între filtre */ /* cite: 2 */
      margin-top: 1.5em; /* cite: 2 */
      width: 90%; /* cite: 2 */
      max-width: 800px; /* cite: 2 */
    }

    #filters input, #filters select {
      padding: 0.8em 1.2em; /* cite: 2 */
      border-radius: 12px; /* Colțuri mai rotunde */ /* cite: 2 */
      border: 1px solid var(--border-color); /* Bordură gri mediu */ /* cite: 2 */
      font-size: 1em; /* cite: 2 */
      min-width: 140px; /* Asigură o lățime minimă */ /* cite: 2 */
      flex: 1; /* Permite elementelor să se extindă/micșoreze */ /* cite: 2 */
      box-sizing: border-box; /* cite: 2 */
      transition: border-color 0.3s ease, box-shadow 0.3s ease; /* cite: 2 */
      background-color: var(--input-bg); /* Fundal gri foarte deschis */ /* cite: 2 */
      color: var(--text-dark); /* Text gri închis */ /* cite: 2 */
      /* Stiluri pentru a personaliza aspectul dropdown-ului (select) */
      -webkit-appearance: none; /* cite: 2 */
      -moz-appearance: none; /* cite: 2 */
      appearance: none; /* cite: 2 */
      background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cpath fill='%23666' d='M9.293 12.95l.707.707 4-4-1.414-1.414L10 10.828 6.707 7.536 5.293 8.95z'/%3E%3Csvg%3E"); /* Iconiță săgeată gri */ /* cite: 2 */
      background-repeat: no-repeat; /* cite: 2 */
      background-position: right 0.7em top 50%, 0 0; /* cite: 2 */
      background-size: 0.8em auto, 100%; /* cite: 2 */
    }

    #filters input:focus, #filters select:focus {
      border-color: var(--secondary-color); /* Bordură focus gri închis */ /* cite: 2 */
      outline: none; /* cite: 2 */
      box-shadow: 0 0 0 4px rgba(85, 85, 85, 0.3); /* Inel de focus (rgba din --secondary-color) */ /* cite: 2 */
    }

    /* Conținut Principal */
    main {
      padding: 3em 1.5em; /* Padding generos în jurul conținutului */ /* cite: 2 */
      max-width: 1300px; /* Lățime maximă pentru conținutul central */ /* cite: 2 */
      margin: 0 auto; /* Centrează conținutul principal */ /* cite: 2 */
    }

    section {
      margin-bottom: 3.5em; /* Spațiu mai mare între secțiuni */ /* cite: 2 */
    }

    h2 {
        font-family: 'Poppins', sans-serif; /* cite: 2 */
        color: var(--secondary-color); /* Culoare pentru titlurile de secțiune - Gri închis */ /* cite: 2 */
        text-align: center; /* cite: 2 */
        margin-bottom: 2em; /* Spațiu sub titluri */ /* cite: 2 */
        font-size: 2.4em; /* cite: 2 */
        font-weight: 600; /* cite: 2 */
        text-transform: uppercase; /* cite: 2 */
        letter-spacing: 0.05em; /* cite: 2 */
    }

    /* Grid pentru Recomandări */
    #recommendations {
        display: grid; /* cite: 2 */
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Grid responsiv */ /* cite: 2 */
        gap: 1.5em; /* Spațiu între elementele grid-ului */ /* cite: 2 */
    }

    /* Card Dispozitiv */
    .device-card {
      background-color: var(--card-bg); /* Fundal gri deschis pentru carduri */ /* cite: 2 */
      padding: 1.8em; /* Mai mult padding */ /* cite: 2 */
      border-radius: 15px; /* Colțuri și mai rotunde */ /* cite: 2 */
      box-shadow: 0 6px 20px var(--shadow-light); /* Umbră mai pronunțată, dar subtilă */ /* cite: 2 */
      cursor: pointer; /* cite: 2 */
      position: relative; /* cite: 2 */
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease; /* Adaugă border-color la tranziție */ /* cite: 2 */
      display: flex; /* cite: 2 */
      flex-direction: column; /* cite: 2 */
      justify-content: flex-start; /* Aliniază conținutul la începutul cardului */ /* cite: 2 */
      align-items: center; /* Centrează conținutul orizontal în card */ /* cite: 2 */
      text-align: center; /* Centrează textul din card */ /* cite: 2 */
      border: 2px solid transparent; /* Bordură transparentă implicit, pentru a evita salturi de layout */ /* cite: 2 */
    }

    /* Stil NOU: Bordură roșie pentru cardurile favorite */
    .device-card.is-favorited-card {
        border-color: var(--accent-color); /* Bordură roșie subțire */ /* cite: 2 */
    }

    .device-card:hover {
      transform: translateY(-8px); /* Efect de ridicare mai pronunțat */ /* cite: 2 */
      box-shadow: 0 12px 30px var(--shadow-medium); /* Umbră mai adâncă la hover */ /* cite: 2 */
    }

    /* Stiluri pentru caseta de acțiuni deasupra */
    .device-actions {
        width: 100%; /* Ocupă toată lățimea cardului */ /* cite: 2 */
        display: flex; /* cite: 2 */
        justify-content: flex-end; /* Aliniază butoanele la dreapta */ /* cite: 2 */
        gap: 10px; /* cite: 2 */
        margin-bottom: 1em; /* cite: 2 */
        padding-bottom: 1em; /* cite: 2 */
        border-bottom: 1px solid var(--border-color); /* Bordură gri mediu */ /* cite: 2 */
        z-index: 10; /* cite: 2 */
        box-sizing: border-box; /* Asigură că padding-ul nu adaugă la lățimea totală */ /* cite: 2 */
    }

    .device-actions button {
        padding: 9px 14px; /* cite: 2 */
        border: none; /* cite: 2 */
        border-radius: 8px; /* cite: 2 */
        cursor: pointer; /* cite: 2 */
        font-size: 0.95em; /* cite: 2 */
        font-weight: 500; /* cite: 2 */
        transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease; /* cite: 2 */
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15); /* cite: 2 */
        color: var(--text-light); /* Text alb pe butoane colorate */ /* cite: 2 */
    }

    .device-actions button:hover {
        transform: translateY(-2px); /* cite: 2 */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* cite: 2 */
    }

    .device-actions button.edit-btn {
        background-color: var(--secondary-color); /* Buton editare - Gri închis */ /* cite: 2 */
    }

    .device-actions button.edit-btn:hover {
        background-color: #444444; /* Nuanță mai închisă la hover */ /* cite: 2 */
    }

    .device-actions button.delete-btn {
        background-color: var(--accent-color); /* Buton ștergere - Roșu */ /* cite: 2 */
    }

    .device-actions button.delete-btn:hover {
        background-color: #c82333; /* Nuanță mai închisă la hover */ /* cite: 2 */
    }

    /* NOU: Stiluri pentru butonul de favorite */
    .device-actions button.favorite-btn {
        background-color: var(--favorite-color-base); /* Portocaliu deschis pentru favorite */ /* cite: 2 */
        color: var(--text-dark); /* Text gri închis */ /* cite: 2 */
    }
    .device-actions button.favorite-btn.favorited {
        background-color: var(--favorite-color-active); /* Portocaliu mediu când e favorit */ /* cite: 2 */
        color: var(--text-light); /* Text alb */ /* cite: 2 */
    }
    .device-actions button.favorite-btn:hover {
        background-color: var(--favorite-color-active); /* Portocaliu mediu la hover */ /* cite: 2 */
    }

    /* Stiluri pentru imaginea produsului in card */
    .product-image {
        max-width: 100%; /* cite: 2 */
        height: 200px; /* Setează o înălțime fixă pentru toate imaginile */ /* cite: 2 */
        object-fit: contain; /* Asigură că imaginea este conținută în spațiu fără a fi tăiată */ /* cite: 2 */
        border-radius: 8px; /* cite: 2 */
        margin-bottom: 1em; /* cite: 2 */
        display: block; /* cite: 2 */
        margin-left: auto; /* cite: 2 */
        margin-right: auto; /* cite: 2 */
    }

    /* Stil pentru placeholder-ul de imagine când nu există imagine */
    .product-image-placeholder {
        width: 100%; /* cite: 2 */
        height: 200px; /* Aceeași înălțime fixă ca și imaginile */ /* cite: 2 */
        background-color: var(--input-bg); /* Un fundal gri foarte deschis */ /* cite: 2 */
        border-radius: 8px; /* cite: 2 */
        margin-bottom: 1em; /* cite: 2 */
        display: flex; /* cite: 2 */
        align-items: center; /* cite: 2 */
        justify-content: center; /* cite: 2 */
        color: #666; /* cite: 2 */
        font-style: italic; /* cite: 2 */
        text-align: center; /* cite: 2 */
        padding: 10px; /* cite: 2 */
        box-sizing: border-box; /* cite: 2 */
    }


    .device-card h3 {
        color: var(--primary-color); /* Nume produs în card - Portocaliu */ /* cite: 2 */
        margin-top: 0; /* cite: 2 */
        margin-bottom: 0.7em; /* cite: 2 */
        font-size: 1.7em; /* cite: 2 */
        font-weight: 600; /* cite: 2 */
        min-height: 2.5em; /* Asigură o înălțime minimă pentru titlu */ /* cite: 2 */
        display: flex; /* cite: 2 */
        align-items: center; /* cite: 2 */
        justify-content: center; /* cite: 2 */
        width: 100%; /* Ocupă lățimea completă pentru centrare */ /* cite: 2 */
    }

    .device-card p {
        margin-bottom: 0.4em; /* cite: 2 */
        font-size: 1.05em; /* cite: 2 */
        color: #444; /* Text informații produs - Gri mediu */ /* cite: 2 */
        min-height: 1.2em; /* Asigură o înălțime minimă pentru fiecare paragraf */ /* cite: 2 */
        width: 100%; /* Ocupă lățimea completă pentru centrare */ /* cite: 2 */
    }


    .no-results {
      text-align: center; /* cite: 2 */
      font-style: italic; /* cite: 2 */
      color: #666; /* Gri mediu */ /* cite: 2 */
      margin-top: 2.5em; /* cite: 2 */
      font-size: 1.2em; /* cite: 2 */
    }
     .no-results.error {
        color: var(--accent-color); /* Roșu pentru erori */ /* cite: 2 */
     }

    /* Stiluri Modal */
    .modal {
      position: fixed; /* cite: 2 */
      z-index: 1000; /* cite: 2 */
      left: 0; /* cite: 2 */
      top: 0; /* cite: 2 */
      width: 100%; /* cite: 2 */
      height: 100%; /* cite: 2 */
      overflow: auto; /* cite: 2 */
      background-color: rgba(0,0,0,0.6); /* Fundal semi-transparent întunecat */ /* cite: 2 */
      display: none; /* cite: 2 */
      justify-content: center; /* cite: 2 */
      align-items: center; /* cite: 2 */
      animation: fadeIn 0.3s ease-out; /* cite: 2 */
    }

    .modal-content {
      background-color: var(--card-bg); /* Fundal gri deschis */ /* cite: 2 */
      padding: 35px; /* cite: 2 */
      border: none; /* cite: 2 */
      width: 90%; /* cite: 2 */
      max-width: 580px; /* cite: 2 */
      border-radius: 20px; /* cite: 2 */
      box-shadow: 0 10px 40px var(--shadow-medium); /* cite: 2 */
      position: relative; /* cite: 2 */
      animation: slideIn 0.3s ease-out; /* cite: 2 */
    }

    .close-button {
      color: #999; /* Gri deschis */ /* cite: 2 */
      font-size: 36px; /* cite: 2 */
      font-weight: bold; /* cite: 2 */
      position: absolute; /* cite: 2 */
      top: 15px; /* cite: 2 */
      right: 20px; /* cite: 2 */
      cursor: pointer; /* cite: 2 */
      transition: color 0.2s ease; /* cite: 2 */
    }

    .close-button:hover,
    .close-button:focus {
      color: var(--accent-color); /* Roșu la hover/focus */ /* cite: 2 */
    }

    .modal-content h2 {
      text-align: center; /* cite: 2 */
      margin-bottom: 30px; /* cite: 2 */
      color: var(--secondary-color); /* Titlu modal - Gri închis */ /* cite: 2 */
      font-family: 'Poppins', sans-serif; /* cite: 2 */
      font-size: 2.3em; /* cite: 2 */
      font-weight: 600; /* cite: 2 */
    }

    .modal-content form {
      display: flex; /* cite: 2 */
      flex-direction: column; /* cite: 2 */
      gap: 20px; /* cite: 2 */
    }

    .modal-content label {
      font-weight: 600; /* cite: 2 */
      color: #555; /* Gri închis */ /* cite: 2 */
      margin-bottom: 5px; /* cite: 2 */
      font-size: 1.05em; /* cite: 2 */
    }

    .modal-content input[type="text"],
    .modal-content input[type="password"],
    .modal-content input[type="number"],
    .modal-content input[type="url"],
    .modal-content input[type="email"], /* NOU: adaugat tip email */
    .modal-content select {
      padding: 14px; /* cite: 2 */
      border: 1px solid var(--border-color); /* Bordură gri mediu */ /* cite: 2 */
      border-radius: 12px; /* cite: 2 */
      font-size: 1.05em; /* cite: 2 */
      box-sizing: border-box; /* cite: 2 */
      transition: border-color 0.3s ease, box-shadow 0.3s ease; /* cite: 2 */
      background-color: var(--input-bg); /* Fundal gri foarte deschis */ /* cite: 2 */
      color: var(--text-dark); /* Text gri închis */ /* cite: 2 */
    }

    .modal-content input[type="text"]:focus,
    .modal-content input[type="password"]:focus,
    .modal-content input[type="number"]:focus,
    .modal-content input[type="url"]:focus,
    .modal-content input[type="email"]:focus, /* NOU: adaugat tip email */
    .modal-content select:focus {
      border-color: var(--secondary-color); /* Bordură focus gri închis */ /* cite: 2 */
      outline: none; /* cite: 2 */
      box-shadow: 0 0 0 4px rgba(85, 85, 85, 0.3); /* Inel de focus (rgba din --secondary-color) */ /* cite: 2 */
    }

    .modal-buttons {
      display: flex; /* cite: 2 */
      justify-content: center; /* cite: 2 */
      gap: 20px; /* cite: 2 */
      margin-top: 30px; /* cite: 2 */
    }

    .modal-buttons button {
      color: var(--text-light); /* Text alb */ /* cite: 2 */
      padding: 14px 30px; /* cite: 2 */
      border: none; /* cite: 2 */
      border-radius: 25px; /* cite: 2 */
      cursor: pointer; /* cite: 2 */
      font-size: 1.1em; /* cite: 2 */
      font-weight: 600; /* cite: 2 */
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; /* cite: 2 */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* cite: 2 */
      text-transform: uppercase; /* cite: 2 */
      letter-spacing: 0.05em; /* cite: 2 */
    }

    /* Stil specific pentru butonul Conectare și Butonul Update Produs (în afara modal-buttons, preia de aici default) */
    #loginSubmit, #updateProduct {
         background-color: var(--secondary-color); /* Buton Conectare/Update - Gri închis */ /* cite: 2 */
    }

    #loginSubmit:hover, #updateProduct:hover {
        background-color: #444444; /* Nuanță mai închisă la hover */ /* cite: 2 */
        transform: translateY(-3px); /* cite: 2 */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* cite: 2 */
    }

    #registerSubmit, #openRegisterModal { /* NOU: adaugat #openRegisterModal */
        background-color: var(--primary-color); /* Buton Înregistrare - Portocaliu */ /* cite: 2 */
    }
    #registerSubmit:hover, #openRegisterModal:hover { /* NOU: adaugat #openRegisterModal */
        background-color: #E07B00; /* Nuanță mai închisă la hover */ /* cite: 2 */
        transform: translateY(-3px); /* cite: 2 */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* cite: 2 */
    }

    /* Stil specific pentru butoanele de submit produs nou */
    #submitProduct {
         background-color: var(--primary-color); /* Buton Adaugă Produs (modal) - Portocaliu */ /* cite: 2 */
    }
    #submitProduct:hover {
        background-color: #E07B00; /* Nuanță mai închisă la hover */ /* cite: 2 */
        transform: translateY(-3px); /* cite: 2 */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* cite: 2 */
    }


    /* Mesaje de status */
    .status-message { /* NOU: Clasa generală pentru mesaje de status în modal-uri */
      text-align: center;
      margin-top: 20px;
      font-weight: 600;
      padding: 12px;
      border-radius: 10px;
      font-size: 1em;
    }

    .status-message.success {
      color: #155724; /* Verde închis */
      background-color: #d4edda; /* Verde deschis */
      border: 1px solid #c3e6cb; /* Bordură verde */
    }

    .status-message.error {
      color: #721c24; /* Roșu închis */
      background-color: #f8d7da; /* Roșu deschis */
      border: 1px solid #f5c6cb; /* Bordură roșie */
    }


    /* Animații */
    @keyframes fadeIn {
      from { opacity: 0; } /* cite: 2 */
      to { opacity: 1; } /* cite: 2 */
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; } /* cite: 2 */
      to { transform: translateY(0); opacity: 1; } /* cite: 2 */
    }


    /* Design Responsiv */
    @media (max-width: 992px) {
        #recommendations {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* cite: 2 */
        }
    }

    @media (max-width: 768px) {
      header {
        padding: 1.5em 0.8em; /* cite: 2 */
        gap: 1.2em; /* cite: 2 */
      }

      header h1 {
        font-size: 2.2em; /* cite: 2 */
      }

      /* Adjusted positioning and layout for small screens */
      .header-top-right-status {
          position: static; /* Remove absolute positioning */
          display: flex !important; /* Ensure flex display */
          flex-direction: column; /* Stack buttons vertically */
          align-items: center; /* Center vertically */
          width: 100%; /* Take full width */
          gap: 8px; /* Smaller gap */
          margin-top: 1em; /* Add space below the title */
      }
       #userStatusButton, #logoutButton {
           width: 100%; /* Full width on mobile */
           padding: 10px 15px; /* Adjusted padding */
           font-size: 0.95em; /* Smaller font */
           border-radius: 18px; /* Adjusted rounding */
       }

       /* NEW: Responsive for top-left actions */
       .header-top-left-actions {
           position: static;
           width: 100%;
           text-align: center;
           margin-bottom: 0.8em; /* Space between this button and header-actions */
       }
       .header-top-left-actions button {
           width: 100%;
           padding: 10px 15px;
           font-size: 0.95em;
           border-radius: 18px;
       }


      .header-actions {
          flex-direction: column; /* cite: 2 */
          gap: 0.8em; /* cite: 2 */
      }

      #searchInput {
        width: 95%; /* cite: 2 */
        padding: 0.8em 1.2em; /* cite: 2 */
        font-size: 0.95em; /* cite: 2 */
      }

      #filters {
        flex-direction: column; /* cite: 2 */
        width: 95%; /* cite: 2 */
        gap: 0.8em; /* cite: 2 */
      }

      #filters input, #filters select {
        width: 100%; /* cite: 2 */
        min-width: unset; /* cite: 2 */
        padding: 0.7em 1em; /* cite: 2 */
        font-size: 0.9em; /* cite: 2 */
      }

      main {
        padding: 2em 0.8em; /* cite: 2 */
      }

      h2 {
        font-size: 2em; /* cite: 2 */
        margin-bottom: 1.8em; /* cite: 2 */
      }

      #recommendations {
        grid-template-columns: 1fr; /* cite: 2 */
      }

      .device-card {
        padding: 1.5em; /* cite: 2 */
      }

      .device-card h3 {
        font-size: 1.4em; /* cite: 2 */
      }

      .device-card p {
        font-size: 1.05em; /* cite: 2 */
      }

      /* Butoanele de acțiune întotdeauna vizibile pe mobil */
      .device-actions {
          position: static; /* cite: 2 */
          display: flex !important; /* Ensure it's always flex */ /* cite: 2 */
          justify-content: flex-end; /* cite: 2 */
          margin-top: 0.5em; /* cite: 2 */
          gap: 8px; /* cite: 2 */
          padding-bottom: 0.5em; /* cite: 2 */
          border-bottom: 1px solid var(--border-color); /* cite: 2 */
      }
      .device-actions button {
          padding: 8px 12px; /* cite: 2 */
          font-size: 0.85em; /* cite: 2 */
          border-radius: 6px; /* cite: 2 */
      }

      .modal-content {
        padding: 25px; /* cite: 2 */
        width: 95%; /* cite: 2 */
      }

      .modal-content h2 {
        font-size: 2em; /* cite: 2 */
      }

      .modal-content input, .modal-content select {
          padding: 10px; /* cite: 2 */
          font-size: 0.95em; /* cite: 2 */
          border-radius: 10px; /* cite: 2 */
      }
      .modal-buttons {
        flex-direction: column; /* cite: 2 */
        gap: 12px; /* cite: 2 */
      }
      .modal-buttons button {
          width: 100%; /* cite: 2 */
          padding: 12px 20px; /* cite: 2 */
          font-size: 1em; /* cite: 2 */
          border-radius: 12px; /* cite: 2 */
      }

      /* Ajustare responsive pentru boxul RSS */
      .rss-box {
          padding: 1em 1.5em; /* Ajustează paddingul pe mobil */ /* cite: 2 */
          margin: 1em auto; /* Ajustează marginul pe mobil */ /* cite: 2 */
      }
       /* Ajustează paddingul general al footerului dacă e nevoie */
        footer {
            padding: 1em 0.8em; /* cite: 2 */
        }
    }

    @media (max-width: 480px) {
      header h1 {
        font-size: 1.8em; /* cite: 2 */
      }

       /* Ajustare responsive și mai mică pentru butoanele din colț */
      .header-top-right-status {
           gap: 6px;
           margin-top: 0.8em;
      }
       #userStatusButton, #logoutButton {
           padding: 8px 12px;
           font-size: 0.9em;
           border-radius: 15px;
       }

       /* NEW: Responsive for top-left actions on smaller screens */
       .header-top-left-actions button {
           padding: 8px 12px;
           font-size: 0.9em;
           border-radius: 15px;
       }

      #searchInput {
          padding: 0.7em 1em; /* cite: 2 */
          font-size: 0.9em; /* cite: 2 */
          border-radius: 18px; /* cite: 2 */
      }

      #filters input, #filters select {
          padding: 0.6em 0.8em; /* cite: 2 */
          font-size: 0.85em; /* cite: 2 */
          border-radius: 10px; /* cite: 2 */
      }

      h2 {
          font-size: 1.6em; /* cite: 2 */
      }

      .device-card {
          padding: 1em; /* cite: 2 */
      }
      .device-card h3 {
        font-size: 1.1em; /* cite: 2 */
      }
      .device-card p {
        font-size: 0.85em; /* cite: 2 */
      }
      .device-actions button {
          padding: 5px 8px; /* cite: 2 */
          font-size: 0.75em; /* cite: 2 */
      }

      .modal-content {
          padding: 18px; /* cite: 2 */
      }
      .modal-content h2 {
          font-size: 1.7em; /* cite: 2 */
      }
      .modal-content input, .modal-content select {
          padding: 10px; /* cite: 2 */
          font-size: 0.95em; /* cite: 2 */
          border-radius: 10px; /* cite: 2 */
      }
      .modal-buttons {
          padding: 10px 15px; /* cite: 2 */
          font-size: 0.95em; /* cite: 2 */
          border-radius: 12px; /* cite: 2 */
      }
      .close-button {
          font-size: 30px; /* cite: 2 */
          top: 10px; /* cite: 2 */
          right: 15px; /* cite: 2 */
      }

      /* Ajustare responsive și mai mică pentru boxul RSS */
      .rss-box {
           padding: 0.8em 1em; /* cite: 2 */
           margin: 0.8em auto; /* cite: 2 */
           font-size: 0.9em; /* Font size slightly smaller */ /* cite: 2 */
      }
       .rss-box a {
           font-size: 1em; /* Link text size */ /* cite: 2 */
       }
       footer {
          padding: 0.8em 0.5em; /* cite: 2 */
       }
    }

    /* Stil nou pentru boxul RSS din footer */
    .rss-box {
        background-color: var(--card-bg); /* Fundal gri deschis, similar cu cardurile */ /* cite: 2 */
        padding: 1em 2em; /* Padding intern */ /* cite: 2 */
        border-radius: 10px; /* Colțuri rotunde */ /* cite: 2 */
        box-shadow: 0 3px 10px var(--shadow-light); /* Umbră subtilă */ /* cite: 2 */
        display: flex; /* Folosim flexbox pentru a centra conținutul */ /* cite: 2 */
        justify-content: center; /* Centrează orizontal conținutul (linkul) */ /* cite: 2 */
        align-items: center; /* Centrează vertical conținutul (linkul) */ /* cite: 2 */
        width: fit-content; /* Boxul se ajustează la lățimea conținutului */ /* cite: 2 */
        margin: 1.5em auto; /* Centrează boxul orizontal în footer și adaugă spațiu sus/jos */ /* cite: 2 */
        max-width: 90%; /* Asigură că nu este prea lat pe ecrane mari */ /* cite: 2 */
        text-align: center; /* Center the text inside the box */ /* cite: 2 */
    }

    /* Stil specific pentru linkul din interiorul boxului RSS */
    .rss-box a {
        color: var(--primary-color); /* Culoare link - PORTOCALIU */ /* cite: 2 */
        text-decoration: none; /* cite: 2 */
        font-weight: 500; /* cite: 2 */
        transition: color 0.2s ease; /* cite: 2 */
        font-size: 1.1em; /* Păstrează dimensiunea fontului din footer */ /* cite: 2 */
    }

    .rss-box a:hover {
        color: #E07B00; /* Nuanță mai închisă a portocaliului la hover */ /* cite: 2 */
        text-decoration: underline; /* cite: 2 */
    }

    /* Ajustare padding footer general dacă este necesar, acum că boxul are propriul margin */
     footer {
       background-color: var(--neutral-dark); /* cite: 2 */
       color: var(--text-light); /* cite: 2 */
       text-align: center; /* cite: 2 */
       padding: 1.5em 1em; /* Padding redus dacă boxul are deja margin vertical */ /* cite: 2 */
       box-shadow: 0 -4px 10px var(--shadow-medium); /* cite: 2 */
       font-size: 1.1em; /* Se poate muta stilul de font din .rss-box a aici dacă tot footerul are acest stil */ /* cite: 2 */
     }

  </style>
</head>
<body>
  <header>
    <a href="/">
        <h1>Recomandări Dispozitive Electronice</h1>
    </a>
    <div class="header-top-left-actions">
        <button id="viewStatsButton">Vezi Statistici</button>
    </div>
    <div class="header-top-right-status">
         <button id="userStatusButton" style="display: none;"></button>
         <button id="logoutButton" style="display: none;">Deconectare</button>
    </div>

    <div class="header-actions">
        <button id="addProductButton" style="display: none;">Adaugă Produs</button>
        <button id="viewFavoritesButton" style="display: none;">Favoritele mele</button>
        <button id="loginButton">Conectare/Înregistrare</button>
        </div>
    <input type="text" id="searchInput" placeholder="Caută după model sau caracteristici...">
    <div id="filters">
      <input type="number" id="minPrice" placeholder="Preț minim" min="0">
      <input type="number" id="maxPrice" placeholder="Preț maxim" min="0">
      <input type="number" id="batteryLife" placeholder="Autonomie (ore)" min="0">
      <select id="deviceType">
        <option value="">Toate tipurile</option>
        <option value="telefon">Telefon</option>
        <option value="tableta">Tabletă</option>
        <option value="ceas">Ceas</option>
        <option value="drona">Dronă</option>
        <option value="laptop">Laptop</option>
        <option value="casti">Căști</option>
      </select>
    </div>
  </header>

  <main>
    <section id="recommendationsList">
        <h2>Recomandări</h2>
        <div id="recommendations"></div>
    </section>
  </main>

  <footer>
    <div class="rss-box">
        <a href="/rss">RSS Feed</a>
    </div>
  </footer>

  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close-button login-close-button">×</span>
      <h2>Conectare</h2> <form id="loginForm"> <label for="loginUsername">Nume utilizator:</label>
        <input type="text" id="loginUsername" name="username" required> <label for="loginPassword">Parolă:</label>
        <input type="password" id="loginPassword" name="password" required> <div class="modal-buttons">
          <button type="button" id="loginSubmit">Conectare</button>
          <button type="button" id="openRegisterModal">Înregistrare</button>
        </div>
      </form>
      <div id="loginStatusMessage" class="status-message"></div> </div>
  </div>

  <div id="registerModal" class="modal">
    <div class="modal-content">
      <span class="close-button register-close-button">×</span>
      <h2>Înregistrare</h2>
      <form id="registerForm">
        <label for="registerUsername">Nume utilizator:</label>
        <input type="text" id="registerUsername" name="username" required>

        <label for="registerEmail">Email:</label>
        <input type="email" id="registerEmail" name="email" required> <label for="registerPassword">Parolă:</label>
        <input type="password" id="registerPassword" name="password" required>

        <div class="modal-buttons">
          <button type="button" id="registerSubmit">Înregistrare</button>
        </div>
      </form>
      <div id="registerStatusMessage" class="status-message"></div>
    </div>
  </div>

    <div id="addProductModal" class="modal">
    <div class="modal-content">
      <span class="close-button add-product-close-button">×</span>
      <h2>Adaugă Produs Nou</h2>
      <form id="productForm">
        <label for="productNameInput">Nume Produs:</label>
        <input type="text" id="productNameInput" required>

        <label for="productPriceInput">Preț:</label>
        <input type="number" id="productPriceInput" step="0.01" required min="0">

        <label for="productBatteryLifeInput">Autonomie Baterie (ore):</label>
        <input type="number" id="productBatteryLifeInput" min="0">

        <label for="productTypeInput">Tip Produs:</label>
        <select id="productTypeInput" required>
            <option value="">Selectează un tip</option>
            <option value="telefon">Telefon</option>
            <option value="tableta">Tabletă</option>
            <option value="ceas">Ceas</option>
            <option value="drona">Dronă</option>
            <option value="laptop">Laptop</option>
            <option value="casti">Căști</option>
        </select>

        <label for="productFeaturesInput">Caracteristici (separate prin virgulă):</label>
        <input type="text" id="productFeaturesInput" placeholder="Ex: 5G, iOS, Face ID" required>

        <label for="productLinkInput">Link Produs (opțional):</label>
        <input type="url" id="productLinkInput" placeholder="Ex: https://exemplu.com/produs">

        <label for="productImageInput">URL Imagine Produs (opțional):</label>
        <input type="url" id="productImageInput" placeholder="Ex: https://exemplu.com/imagine.jpg">

        <div class="modal-buttons">
          <button type="submit" id="submitProduct">Adaugă Produs</button>
        </div>
      </form>
      <div id="addProductStatusMessage" class="status-message"></div>
    </div>
  </div>

    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <span class="close-button edit-product-close-button">×</span>
            <h2>Editează Produs</h2>
            <form id="editProductForm">
                <input type="hidden" id="editProductId">

                <label for="editProductNameInput">Nume Produs:</label>
                <input type="text" id="editProductNameInput" required>

                <label for="editProductPriceInput">Preț:</label>
                <input type="number" id="editProductPriceInput" step="0.01" required min="0">

                <label for="editProductBatteryLifeInput">Autonomie Baterie (ore):</label>
                <input type="number" id="editProductBatteryLifeInput" min="0">

                <label for="editProductTypeInput">Tip Produs:</label>
                <select id="editProductTypeInput" required>
                    <option value="">Selectează un tip</option>
                    <option value="telefon">Telefon</option>
                    <option value="tableta">Tabletă</option>
                    <option value="ceas">Ceas</option>
                    <option value="drona">Dronă</option>
                    <option value="laptop">Laptop</option>
                    <option value="casti">Căști</option>
                </select>

                <label for="editProductFeaturesInput">Caracteristici (separate prin virgulă):</label>
                <input type="text" id="editProductFeaturesInput" placeholder="Ex: 5G, iOS, Face ID" required>

                <label for="editProductLinkInput">Link Produs (opțional):</label>
                <input type="url" id="editProductLinkInput" placeholder="Ex: https://exemplu.com/produs">

                <label for="editProductImageInput">URL Imagine Produs (opțional):</label>
                <input type="url" id="editProductImageInput" placeholder="Ex: https://exemplu.com/imagine.jpg">

                <div class="modal-buttons">
                    <button type="submit" id="updateProduct">Actualizează Produs</button>
                </div>
            </form>
            <div id="editProductStatusMessage" class="status-message"></div>
        </div>
    </div>


  <script>
    const recommendationsListSection = document.getElementById('recommendationsList');
    
    // Referințe pentru butoane
    const userStatusButton = document.getElementById('userStatusButton');
    const viewStatsButton = document.getElementById('viewStatsButton');

    async function fetchRecommendations(query = '') {
      const minPrice = document.getElementById('minPrice').value;
      const maxPrice = document.getElementById('maxPrice').value;
      const batteryLife = document.getElementById('batteryLife').value;
      const deviceType = document.getElementById('deviceType').value;
      const userRole = localStorage.getItem('userRole');
      const token = localStorage.getItem('token');

      const params = new URLSearchParams({
        q: query,
        minPrice,
        maxPrice,
        batteryLife,
        deviceType
      });

      try {
          const res = await fetch(`/api/recommendations?${params.toString()}`);
          if (!res.ok) {
              console.error('Failed to fetch recommendations:', res.status, res.statusText);
               document.getElementById('recommendations').innerHTML = '<p class="no-results error">Eroare la încărcarea recomandărilor.</p>';
               return;
          }
          let data = await res.json();
          const container = document.getElementById('recommendations');
          container.innerHTML = '';

          if (data.length === 0) {
            container.innerHTML = '<p class="no-results">Nu s-au găsit recomandări conform filtrelor.</p>';
            return;
          }

          if (token) {
              const favoriteProductIds = new Set();
              try {
                  const favRes = await fetch('/api/favorites', {
                      headers: { 'Authorization': `Bearer ${token}` }
                  });
                  if (favRes.ok) {
                      const favProducts = await favRes.json();
                      favProducts.forEach(fav => favoriteProductIds.add(fav.id));
                  } else {
                      console.warn('Nu s-a putut prelua lista de favorite:', favRes.status);
                  }
              } catch (favError) {
                  console.error('Eroare la preluarea listei de favorite pentru UI:', favError);
              }

              data = data.map(device => ({
                  ...device,
                  isFavorited: favoriteProductIds.has(device.id)
              }));
          }


          data.forEach(device => {
            const div = document.createElement('div');
            div.className = 'device-card';
            // ADĂUGĂ CLASA is-favorited-card DACĂ PRODUSUL ESTE FAVORIT
            if (device.isFavorited) {
                div.classList.add('is-favorited-card');
            }
            div.dataset.productId = device.id;

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'device-actions';

            if (userRole === 'admin') {
                const editButton = document.createElement('button');
                editButton.textContent = 'Editează';
                editButton.className = 'edit-btn';
                editButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openEditProductModal(device.id);
                });

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Șterge';
                deleteButton.className = 'delete-btn';
                deleteButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm('Ești sigur că vrei să ștergi acest produs?')) {
                        deleteProduct(device.id);
                    }
                });
                actionsDiv.appendChild(editButton);
                actionsDiv.appendChild(deleteButton);
            }

            if (token) {
                const favoriteButton = document.createElement('button');
                favoriteButton.textContent = device.isFavorited ? 'Elimină din Favorite' : 'Adaugă la Favorite';
                favoriteButton.className = 'favorite-btn';
                if (device.isFavorited) {
                    favoriteButton.classList.add('favorited');
                }
                favoriteButton.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    if (device.isFavorited) {
                        await removeFromFavorites(device.id);
                    } else {
                        await addToFavorites(device.id);
                    }
                    fetchRecommendations(document.getElementById('searchInput').value); // Refresh list to update button state
                });
                actionsDiv.appendChild(favoriteButton);
            }

            div.insertBefore(actionsDiv, div.firstChild);

            // Add image element or placeholder
            if (device.image) {
                const img = document.createElement('img');
                img.src = device.image;
                img.alt = device.name;
                img.className = 'product-image';
                div.appendChild(img);
            } else {
                const placeholder = document.createElement('div');
                placeholder.className = 'product-image-placeholder';
                placeholder.textContent = 'Fără imagine';
                div.appendChild(placeholder);
            }


            const contentHTML = `
              <h3>${device.name}</h3>
              <p>Preț: ${device.price} Lei</p>
              <p>Caracteristici: ${device.features.join(', ')}</p>
            `;
             const tempDiv = document.createElement('div');
             tempDiv.innerHTML = contentHTML;
             while(tempDiv.firstChild) {
                 div.appendChild(tempDiv.firstChild);
             }

            div.addEventListener('click', (e) => {
                if (!e.target.closest('.device-actions button')) {
                     window.location.href = `/product-details.html?product_id=${device.id}`;
                }
            });
            container.appendChild(div);
          });
      } catch (error) {
           console.error('Error fetching recommendations:', error);
           document.getElementById('recommendations').innerHTML = '<p class="no-results error">Eroare la încărcarea recomandărilor.</p>';
      }
    }

    document.getElementById('searchInput').addEventListener('input', () => {
      fetchRecommendations(document.getElementById('searchInput').value);
    });

    document.querySelectorAll('#filters input[type="number"]').forEach(el => {
      el.addEventListener('input', function() {
          if (this.valueAsNumber < 0) {
              this.value = 0;
          }
           fetchRecommendations(document.getElementById('searchInput').value);
      });
    });

     document.querySelectorAll('#filters select').forEach(el => {
       el.addEventListener('input', function() {
           fetchRecommendations(document.getElementById('searchInput').value);
       });
     });


    // --- Logica Modalului de Login/Înregistrare ---
    const loginButton = document.getElementById('loginButton');
    const logoutButton = document.getElementById('logoutButton');
    const loginModal = document.getElementById('loginModal');
    const closeLoginButton = document.querySelector('.login-close-button');
    const loginSubmitButton = document.getElementById('loginSubmit');

    // NOU: Referințe pentru modalul de înregistrare
    const registerModal = document.getElementById('registerModal');
    const closeRegisterButton = document.querySelector('.register-close-button');
    const openRegisterModalButton = document.getElementById('openRegisterModal'); // Butonul din loginModal care deschide registerModal
    const registerSubmitButton = document.getElementById('registerSubmit');
    const registerUsernameInput = document.getElementById('registerUsername');
    const registerEmailInput = document.getElementById('registerEmail'); // NOU: Câmp email
    const registerPasswordInput = document.getElementById('registerPassword');
    const registerStatusMessageDiv = document.getElementById('registerStatusMessage');

    // Referințe actualizate pentru modalul de login
    const loginForm = document.getElementById('loginForm');
    const loginUsernameInput = document.getElementById('loginUsername');
    const loginPasswordInput = document.getElementById('loginPassword');
    const loginStatusMessageDiv = document.getElementById('loginStatusMessage');


    let tokenExpiryCheckInterval;

    loginButton.addEventListener('click', () => {
      loginModal.style.display = 'flex';
      loginStatusMessageDiv.textContent = ''; // Resetează mesajul de status
      loginStatusMessageDiv.className = 'status-message';
      loginUsernameInput.value = ''; // Resetează câmpurile
      loginPasswordInput.value = '';
    });

    closeLoginButton.addEventListener('click', () => {
      loginModal.style.display = 'none';
    });

    // NOU: Event listener pentru a deschide modalul de înregistrare din cel de login
    openRegisterModalButton.addEventListener('click', () => {
      loginModal.style.display = 'none'; // Închide modalul de login
      registerModal.style.display = 'flex'; // Deschide modalul de înregistrare
      registerStatusMessageDiv.textContent = ''; // Resetează mesajul
      registerStatusMessageDiv.className = 'status-message';
      registerUsernameInput.value = '';
      registerEmailInput.value = ''; // Resetează câmpul email
      registerPasswordInput.value = '';
    });

    // NOU: Event listener pentru a închide modalul de înregistrare
    closeRegisterButton.addEventListener('click', () => {
      registerModal.style.display = 'none';
    });


    window.addEventListener('click', (event) => {
      if (event.target == loginModal) {
        loginModal.style.display = 'none';
      }
      if (event.target == registerModal) { // NOU
        registerModal.style.display = 'none';
      }
    });

    // NOU: Funcții specifice pentru mesaje de status
    function showLoginStatusMessage(message, type) {
        loginStatusMessageDiv.textContent = message;
        loginStatusMessageDiv.className = `status-message ${type}`; // Adaugă clasa generală
    }

    function showRegisterStatusMessage(message, type) {
        registerStatusMessageDiv.textContent = message;
        registerStatusMessageDiv.className = `status-message ${type}`; // Adaugă clasa generală
    }


    function decodeJwt(token) {
        try {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        } catch (e) {
            console.error("Failed to decode JWT:", e);
            return null;
        }
    }

    function checkTokenExpiry() {
        const token = localStorage.getItem('token');
        if (token) {
            const decodedToken = decodeJwt(token);
            if (decodedToken && decodedToken.exp) {
                const currentTime = Date.now() / 1000;
                if (decodedToken.exp < currentTime) {
                    console.log("Token expired. Logging out...");
                    logoutUser();
                    return;
                }
            }
        }
        if (!token && tokenExpiryCheckInterval) {
             clearInterval(tokenExpiryCheckInterval);
             tokenExpiryCheckInterval = null;
        }
    }

    function updateAuthUI() {
      const token = localStorage.getItem('token');
      const role = localStorage.getItem('userRole');
      const username = localStorage.getItem('username');
      const addProductButton = document.getElementById('addProductButton');
      const viewFavoritesButton = document.getElementById('viewFavoritesButton');
      const userStatusButton = document.getElementById('userStatusButton');
      const headerTopRightStatusDiv = document.querySelector('.header-top-right-status');

      if (tokenExpiryCheckInterval) {
          clearInterval(tokenExpiryCheckInterval);
          tokenExpiryCheckInterval = null;
      }

      if (token && role && username) {
        // Logged in state
        loginButton.style.display = 'none';
        headerTopRightStatusDiv.style.display = 'flex';
        userStatusButton.style.display = 'block';
        logoutButton.style.display = 'block';
        viewFavoritesButton.style.display = 'block';
        

        userStatusButton.textContent = `${username} (${role})`;


        if (role === 'admin') {
            addProductButton.style.display = 'block';
        } else {
            addProductButton.style.display = 'none';
        }

        tokenExpiryCheckInterval = setInterval(checkTokenExpiry, 5000);
      } else {
        // Logged out state
        loginButton.style.display = 'block';
        headerTopRightStatusDiv.style.display = 'none';
        userStatusButton.style.display = 'none';
        logoutButton.style.display = 'none';
        addProductButton.style.display = 'none';
        viewFavoritesButton.style.display = 'none';
      }
      fetchRecommendations(document.getElementById('searchInput').value);
    }

    loginSubmitButton.addEventListener('click', async (event) => {
      event.preventDefault();
      const username = loginUsernameInput.value; // Folosește ID-ul nou
      const password = loginPasswordInput.value; // Folosește ID-ul nou

      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ username, password }),
        });

        const data = await response.json();

        if (response.ok) {
          showLoginStatusMessage(data.message, 'success'); // Folosește funcția specifică
          localStorage.setItem('token', data.token);
          localStorage.setItem('userRole', data.role);
          localStorage.setItem('username', data.username);
          updateAuthUI();
          setTimeout(() => {
            loginModal.style.display = 'none';
          }, 1500);
        } else {
          showLoginStatusMessage(data.message || 'Eroare la conectare.', 'error'); // Folosește funcția specifică
        }
      } catch (error) {
        console.error('Eroare la conectare:', error);
        showLoginStatusMessage('Eroare la conectare. Vă rugăm să încercați din nou.', 'error'); // Folosește funcția specifică
      }
    });

    registerSubmitButton.addEventListener('click', async (event) => {
      event.preventDefault();
      const username = registerUsernameInput.value; // Folosește ID-ul nou
      const email = registerEmailInput.value; // NOU: Preluare email
      const password = registerPasswordInput.value; // Folosește ID-ul nou

      const minLength = 6;
      const hasUppercase = /[A-Z]/.test(password);
      const hasDigit = /\d/.test(password);

      if (!email || !/\S+@\S+\.\S+/.test(email)) { // NOU: Validare email
        showRegisterStatusMessage('Vă rugăm să introduceți o adresă de email validă.', 'error');
        return;
      }

      if (password.length < minLength) {
        showRegisterStatusMessage(`Parola trebuie să aibă minim ${minLength} caractere.`, 'error');
        return;
      }
      if (!hasUppercase) {
        showRegisterStatusMessage('Parola trebuie să conțină cel puțin o literă mare.', 'error');
        return;
      }
      if (!hasDigit) {
        showRegisterStatusMessage('Parola trebuie să conțină cel puțin o cifră.', 'error');
        return;
      }

      try {
        // NOU: Include email în corpul cererii
        const response = await fetch('/api/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ username, password, email }),
        });

        const data = await response.json();

        if (response.ok) {
          showRegisterStatusMessage(data.message, 'success'); // Folosește funcția specifică
           registerUsernameInput.value = '';
           registerEmailInput.value = ''; // Resetează câmpul email
           registerPasswordInput.value = '';
           // Poți alege să închizi modalul de înregistrare și să deschizi direct pe cel de login
           setTimeout(() => {
               registerModal.style.display = 'none';
               loginModal.style.display = 'flex'; // Deschide modalul de login după înregistrare
               showLoginStatusMessage('Acum vă puteți conecta.', 'success');
           }, 1500);

        } else {
          showRegisterStatusMessage(data.message || 'Eroare la înregistrare.', 'error'); // Folosește funcția specifică
        }
      } catch (error) {
        console.error('Eroare la înregistrare:', error);
        showRegisterStatusMessage('Eroare la înregistrare. Vă rugăm să încercați din nou.', 'error'); // Folosește funcția specifică
      }
    });

    function logoutUser() {
      localStorage.removeItem('token');
      localStorage.removeItem('userRole');
      localStorage.removeItem('username');
      if (tokenExpiryCheckInterval) {
          clearInterval(tokenExpiryCheckInterval);
          tokenExpiryCheckInterval = null;
      }
      updateAuthUI();
    }
    logoutButton.addEventListener('click', logoutUser);

    viewFavoritesButton.addEventListener('click', () => {
        window.location.href = '/favorites.html';
    });

    // NEW: Event listener for the "View Statistics" button
    viewStatsButton.addEventListener('click', () => {
        window.location.href = '/stats.html';
    });


    // --- Logica Modalului de Adăugare Produs ---
    const addProductModal = document.getElementById('addProductModal');
    const closeAddProductButton = document.querySelector('.add-product-close-button');
    const submitProductButton = document.getElementById('submitProduct');
    const productNameInput = document.getElementById('productNameInput');
    const productPriceInput = document.getElementById('productPriceInput');
    const productBatteryLifeInput = document.getElementById('productBatteryLifeInput');
    const productTypeInput = document.getElementById('productTypeInput');
    const productFeaturesInput = document.getElementById('productFeaturesInput');
    const productLinkInput = document.getElementById('productLinkInput');
    const productImageInput = document.getElementById('productImageInput');
    const addProductStatusMessageDiv = document.getElementById('addProductStatusMessage');

    document.getElementById('addProductButton').addEventListener('click', () => {
      addProductModal.style.display = 'flex';
      addProductStatusMessageDiv.textContent = '';
      addProductStatusMessageDiv.className = 'status-message'; // Adaugă clasa generală
      document.getElementById('productForm').reset();
    });

    closeAddProductButton.addEventListener('click', () => {
      addProductModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
      if (event.target == addProductModal) {
        addProductModal.style.display = 'none';
      }
    });

    function showAddProductStatusMessage(message, type) {
        addProductStatusMessageDiv.textContent = message;
        addProductStatusMessageDiv.className = `status-message ${type}`; // Adaugă clasa generală
    }

    submitProductButton.addEventListener('click', async (event) => {
        event.preventDefault();

        const name = productNameInput.value.trim();
        const price = parseFloat(productPriceInput.value);
        const batteryLife = productBatteryLifeInput.value ? parseInt(productBatteryLifeInput.value, 10) : null;
        const type = productTypeInput.value;
        const features = productFeaturesInput.value.split(',').map(f => f.trim()).filter(f => f.length > 0);
        const link = productLinkInput.value.trim();
        const image = productImageInput.value.trim();

        if (!name || isNaN(price) || price <= 0 || !type || features.length === 0) {
            showAddProductStatusMessage('Vă rugăm să completați toate câmpurile obligatorii: Nume, Preț valid (>0), Tip și cel puțin o Caracteristică.', 'error');
            return;
        }

        const token = localStorage.getItem('token');
        if (!token) {
            showAddProductStatusMessage('Nu sunteți autentificat. Vă rugăm să vă conectați ca administrator.', 'error');
            return;
        }

        try {
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ name, price, batteryLife, type, features, link, image })
            });

            const data = await response.json();

            if (response.ok) {
                showAddProductStatusMessage(data.message, 'success');
                document.getElementById('productForm').reset();
                updateAuthUI(); // Va reîncărca lista de recomandări și statistici
                setTimeout(() => {
                    addProductModal.style.display = 'none';
                }, 1500);
            } else {
                showAddProductStatusMessage(data.message || 'Eroare la adăugarea produsului.', 'error');
            }
        } catch (error) {
            console.error('Eroare la adăugarea produsului:', error);
            showAddProductStatusMessage('A apărut o eroare la trimiterea datelor. Vă rugăm să încercați din nou.', 'error');
        }
    });

    // --- Logica Modalului de Editare Produs ---
    const editProductModal = document.getElementById('editProductModal');
    const closeEditProductButton = document.querySelector('.edit-product-close-button');
    const updateProductButton = document.getElementById('updateProduct');
    const editProductIdInput = document.getElementById('editProductId');
    const editProductNameInput = document.getElementById('editProductNameInput');
    const editProductPriceInput = document.getElementById('editProductPriceInput');
    const editProductBatteryLifeInput = document.getElementById('editProductBatteryLifeInput');
    const editProductTypeInput = document.getElementById('editProductTypeInput');
    const editProductFeaturesInput = document.getElementById('editProductFeaturesInput');
    const editProductLinkInput = document.getElementById('editProductLinkInput');
    const editProductImageInput = document.getElementById('editProductImageInput');
    const editProductStatusMessageDiv = document.getElementById('editProductStatusMessage');

    function showEditProductStatusMessage(message, type) {
        editProductStatusMessageDiv.textContent = message;
        editProductStatusMessageDiv.className = `status-message ${type}`; // Adaugă clasa generală
    }

    async function openEditProductModal(productId) {
        editProductStatusMessageDiv.textContent = '';
        editProductStatusMessageDiv.className = 'status-message'; // Adaugă clasa generală

        try {
            const userRole = localStorage.getItem('userRole');
            const token = localStorage.getItem('token');
            if (userRole !== 'admin' || !token) {
                 alert('Nu aveți permisiunea de a edita produse.');
                 return;
            }

            const res = await fetch(`/api/products/${productId}`, {
                 headers: {
                    'Authorization': `Bearer ${token}`
                 }
            });
            const product = await res.json();

            if (res.ok) {
                editProductIdInput.value = product.id;
                editProductNameInput.value = product.name;
                editProductPriceInput.value = product.price;
                editProductBatteryLifeInput.value = product.batterylife || '';
                editProductTypeInput.value = product.type;
                editProductFeaturesInput.value = product.features.join(', ');
                editProductLinkInput.value = product.link && product.link !== 'null' ? product.link : '';
                editProductImageInput.value = product.image && product.image !== 'null' ? product.image : '';

                editProductModal.style.display = 'flex';
            } else {
                showEditProductStatusMessage(product.message || `Eroare la preluarea datelor produsului (Status: ${res.status}).`, 'error');
                 editProductModal.style.display = 'none';
            }
        } catch (error) {
            console.error('Error fetching product for edit:', error);
            showEditProductStatusMessage('A apărut o eroare la încărcarea datelor produsului pentru editare. Verificați conexiunea și autentificarea.', 'error');
             editProductModal.style.display = 'none';
        }
    }

    closeEditProductButton.addEventListener('click', () => {
      editProductModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
      if (event.target == editProductModal) {
        editProductModal.style.display = 'none';
      }
    });

    updateProductButton.addEventListener('click', async (event) => {
        event.preventDefault();

        const productId = editProductIdInput.value;
        const name = editProductNameInput.value.trim();
        const price = parseFloat(editProductPriceInput.value);
        const batteryLife = editProductBatteryLifeInput.value ? parseInt(editProductBatteryLifeInput.value, 10) : null;
        const type = editProductTypeInput.value;
        const features = editProductFeaturesInput.value.split(',').map(f => f.trim()).filter(f => f.length > 0);
        const link = productLinkInput.value.trim();
        const image = productImageInput.value.trim();

         if (!productId || !name || isNaN(price) || price <= 0 || !type || features.length === 0) {
            showEditProductStatusMessage('Vă rugăm să completați toate câmpurile obligatorii: Nume, Preț valid (>0), Tip și cel puțin o Caracteristică.', 'error');
            return;
        }

        const token = localStorage.getItem('token');
        if (!token) {
            showEditProductStatusMessage('Nu sunteți autentificat. Vă rugăm să vă conectați ca administrator.', 'error');
            return;
        }

        try {
            const response = await fetch(`/api/products/${productId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ name, price, batteryLife, type, features, link, image })
            });

            const data = await response.json();

            if (response.ok) {
                showEditProductStatusMessage(data.message, 'success');
                updateAuthUI(); // Va reîncărca lista de recomandări și statistici
                setTimeout(() => {
                    editProductModal.style.display = 'none';
                }, 1500);
            } else {
                showEditProductStatusMessage(data.message || `Eroare la actualizarea produsului (Status: ${response.status}).`, 'error');
            }
        } catch (error) {
            console.error('Eroare la actualizarea produsului:', error);
            showEditProductStatusMessage('A apărut o eroare la trimiterea datelor de actualizare. Verificați conexiunea și autentificarea.', 'error');
        }
    });

    async function deleteProduct(productId) {
        const token = localStorage.getItem('token');
        const userRole = localStorage.getItem('userRole');

        if (userRole !== 'admin' || !token) {
            alert('Nu aveți permisiunea de a șterge produse. Vă rugăm să vă conectați ca administrator.');
            return;
        }

        if (!confirm('Ești sigur că vrei să ștergi acest produs?')) {
             return;
        }

        try {
            const response = await fetch(`/api/products/${productId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            const data = await response.json();

            if (response.ok) {
                alert(data.message);
                updateAuthUI(); // Va reîncărca lista de recomandări și statistici
            } else {
                alert(data.message || `Eroare la ștergerea produsului (Status: ${response.status}).`);
            }
        } catch (error) {
            console.error('Eroare la ștergerea produsului:', error);
            alert('A apărut o eroare la ștergerea produsului. Verificați conexiunea și autentificarea.');
        }
    }

    async function addToFavorites(productId) {
        const token = localStorage.getItem('token');
        if (!token) {
            alert('Trebuie să fii autentificat pentru a adăuga produse la favorite.');
            return;
        }
        try {
            const response = await fetch('/api/favorites', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ productId })
            });
            const data = await response.json();
            if (response.ok) {
                // alert(data.message); // Oprim alerta pentru a fi mai puțin intruziv
            } else {
                alert(data.message || 'Eroare la adăugarea la favorite.');
            }
        } catch (error) {
            console.error('Eroare la adăugarea la favorite:', error);
            alert('A apărut o eroare de rețea la adăugarea la favorite.');
        }
    }

    async function removeFromFavorites(productId) {
        const token = localStorage.getItem('token');
        if (!token) {
            alert('Trebuie să fii autentificat pentru a elimina produse din favorite.');
            return;
        }
        try {
            const response = await fetch(`/api/favorites/${productId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            const data = await response.json();
            if (response.ok) {
                // alert(data.message); // Oprim alerta
            } else {
                alert(data.message || 'Eroare la eliminarea din favorite.');
            }
        } catch (error) {
            console.error('Eroare la eliminarea din favorite:', error);
            alert('A apărut o eroare de rețea la eliminarea din favorite.');
        }
    }


    // Actualizare UI inițială la încărcarea paginii
    document.addEventListener('DOMContentLoaded', updateAuthUI);
  </script>
</body>
</html>