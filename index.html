<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recomandări Dispozitive Electronice</title>
  <!-- Link Google Fonts for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    /* Definire variabile CSS pentru culori și umbre pentru consistență și ușurință în modificare */
    :root {
      --primary-color: #4CAF50; /* Verde intens - pentru acțiuni pozitive, highlight */
      --secondary-color: #007bff; /* Albastru - pentru acțiuni principale, titluri, link-uri */
      --accent-color: #f44336; /* Roșu - pentru acțiuni de avertizare/ștergere */
      --neutral-dark: #2c3e50; /* Gri-albăstrui închis - pentru fundaluri întunecate (header, footer) */
      --neutral-light: #ecf0f1; /* Gri deschis - pentru fundalul principal al paginii */
      --text-dark: #34495e; /* Gri-albăstrui închis - pentru text principal */
      --text-light: #ffffff; /* Alb - pentru text pe fundal întunecat */
      --border-color: #bdc3c7; /* Gri deschis pentru borduri */
      --shadow-light: rgba(0, 0, 0, 0.08); /* Umbra ușoară */
      --shadow-medium: rgba(0, 0, 0, 0.15); /* Umbra medie */
    }

    body {
      font-family: 'Roboto', sans-serif; /* Font modern și lizibil */
      margin: 0;
      padding: 0;
      background-color: var(--neutral-light); /* Fundal mai cald și plăcut */
      color: var(--text-dark);
      line-height: 1.6; /* Îmbunătățește lizibilitatea textului */
    }

    header {
      background-color: var(--neutral-dark);
      padding: 1.5em 1em; /* Mai mult padding vertical */
      color: var(--text-light);
      text-align: center;
      position: relative;
      box-shadow: 0 4px 10px var(--shadow-medium); /* Adaugă adâncime header-ului */
      display: flex;
      flex-direction: column; /* Stivuiește elementele pe verticală */
      align-items: center;
      gap: 1.5em; /* Spațiu între elementele din header */
    }

    header h1 {
        font-family: 'Poppins', sans-serif; /* Font impactant pentru titlu */
        margin: 0; /* Elimină marginile implicite */
        font-size: 2.8em; /* Titlu mai mare */
        color: var(--primary-color); /* Colorează titlul */
        letter-spacing: -0.03em; /* Spațiere ușor mai strânsă a literelor */
    }

    /* Container pentru butoanele de autentificare și administrare */
    .header-actions {
        display: flex;
        justify-content: center; /* Centrează butoanele */
        align-items: center;
        width: 100%; /* Ocupă lățimea completă */
        flex-wrap: wrap; /* Permite înfășurarea pe ecrane mici */
        gap: 1em; /* Spațiu între butoane */
    }

    #authStatus {
        color: var(--text-light);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 12px; /* Spațiu între mesaj și buton */
    }

    #loginButton, #logoutButton, #addProductButton {
      padding: 12px 22px; /* Padding generos */
      border: none;
      border-radius: 25px; /* Butoane rotunde tip "pastilă" */
      cursor: pointer;
      font-size: 1.05em;
      font-weight: 600;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; /* Tranziții pentru hover */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Umbră subtilă pentru butoane */
      text-transform: uppercase; /* Text cu majuscule */
      letter-spacing: 0.05em; /* Spațiere a literelor */
    }

    #loginButton {
        background-color: var(--secondary-color);
        color: var(--text-light);
    }

    #loginButton:hover {
        background-color: #0056b3;
        transform: translateY(-3px); /* Efect de ridicare */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); /* Umbră mai pronunțată */
    }

    #logoutButton {
        background-color: var(--accent-color);
        color: var(--text-light);
    }

    #logoutButton:hover {
        background-color: #da190b;
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }

    #addProductButton {
        background-color: var(--primary-color);
        color: var(--text-light);
    }

    #addProductButton:hover {
        background-color: #3f9442;
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }

    /* Căutare și Filtre */
    #searchInput {
      padding: 0.9em 1.5em; /* Mai mult padding */
      border: 1px solid var(--border-color);
      border-radius: 25px; /* Formă de pastilă */
      font-size: 1.05em;
      width: 90%; /* Ocupă mai multă lățime */
      max-width: 600px; /* Lățime maximă */
      box-sizing: border-box; /* Include padding-ul în lățime */
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      background-color: var(--text-light); /* Fundal deschis */
      color: var(--text-dark);
    }

    #searchInput::placeholder {
        color: #999; /* Culoare placeholder */
    }

    #searchInput:focus {
      border-color: var(--secondary-color);
      outline: none; /* Elimină outline-ul default */
      box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.3); /* Inel de focus mai moale */
    }

    #filters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.2em; /* Spațiu între filtre */
      margin-top: 1.5em;
      width: 90%;
      max-width: 800px;
    }

    #filters input, #filters select {
      padding: 0.8em 1.2em;
      border-radius: 12px; /* Colțuri mai rotunde */
      border: 1px solid var(--border-color);
      font-size: 1em;
      min-width: 140px; /* Asigură o lățime minimă */
      flex: 1; /* Permite elementelor să se extindă/micșoreze */
      box-sizing: border-box;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      background-color: var(--text-light);
      color: var(--text-dark);
      /* Stiluri pentru a personaliza aspectul dropdown-ului (select) */
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cpath fill='%23666' d='M9.293 12.95l.707.707 4-4-1.414-1.414L10 10.828 6.707 7.536 5.293 8.95z'/%3E%3Csvg%3E");
      background-repeat: no-repeat;
      background-position: right 0.7em top 50%, 0 0;
      background-size: 0.8em auto, 100%;
    }

    #filters input:focus, #filters select:focus {
      border-color: var(--secondary-color);
      outline: none;
      box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.3);
    }

    /* Conținut Principal */
    main {
      padding: 3em 1.5em; /* Padding generos în jurul conținutului */
      max-width: 1300px; /* Lățime maximă pentru conținutul central */
      margin: 0 auto; /* Centrează conținutul principal */
    }

    section {
      margin-bottom: 3.5em; /* Spațiu mai mare între secțiuni */
    }

    h2 {
        font-family: 'Poppins', sans-serif;
        color: var(--secondary-color); /* Culoare pentru titlurile de secțiune */
        text-align: center;
        margin-bottom: 2em; /* Spațiu sub titluri */
        font-size: 2.4em;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* Grid pentru Recomandări */
    #recommendations {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Grid responsiv */
        gap: 1.5em; /* Spațiu între elementele grid-ului */
    }

    /* Card Dispozitiv */
    .device-card {
      background-color: var(--text-light);
      padding: 1.8em; /* Mai mult padding */
      border-radius: 15px; /* Colțuri și mai rotunde */
      box-shadow: 0 6px 20px var(--shadow-light); /* Umbră mai pronunțată, dar subtilă */
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease; /* Tranziții fluide la hover */
      /* NOU: Folosim flexbox pentru a aranja elementele interne */
      display: flex; 
      flex-direction: column; 
    }

    .device-card:hover {
      transform: translateY(-8px); /* Efect de ridicare mai pronunțat */
      box-shadow: 0 12px 30px var(--shadow-medium); /* Umbră mai adâncă la hover */
    }

    /* NOU: Stiluri pentru caseta de acțiuni deasupra */
    .device-actions {
        display: flex; 
        justify-content: flex-end; /* Aliniază butoanele la dreapta */
        gap: 10px; 
        margin-bottom: 1em; 
        padding-bottom: 1em; 
        border-bottom: 1px solid var(--border-color); 
        z-index: 10; 
    }
    
    .device-actions button {
        padding: 9px 14px;
        border: none; 
        border-radius: 8px;
        cursor: pointer; 
        font-size: 0.95em;
        font-weight: 500;
        transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .device-actions button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .device-actions button.edit-btn {
        background-color: #28a745; /* Verde pentru editare */
        color: white; /* Asigură că textul este alb */
    }

    .device-actions button.edit-btn:hover {
        background-color: #218838;
    }

    .device-actions button.delete-btn {
        background-color: #dc3545; /* Roșu pentru ștergere */
        color: white; /* Asigură că textul este alb */
    }

    .device-actions button.delete-btn:hover {
        background-color: #c82333;
    }

    .device-card h3 {
        color: var(--primary-color); 
        margin-top: 0; 
        margin-bottom: 0.7em;
        font-size: 1.7em;
        font-weight: 600;
    }

    .device-card p {
        margin-bottom: 0.4em;
        font-size: 1.05em;
        color: #666;
    }


    .no-results {
      text-align: center;
      font-style: italic;
      color: #888;
      margin-top: 2.5em;
      font-size: 1.2em;
    }
     .no-results.error {
        color: var(--accent-color);
     }

    /* Statistici Populare */
    #popularList {
        list-style: none; 
        padding: 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Grid responsiv */
        gap: 1em;
    }

    #popularList li {
        background-color: var(--text-light);
        padding: 1em 1.5em;
        border-radius: 10px;
        box-shadow: 0 3px 10px var(--shadow-light);
        font-size: 1.1em;
        color: #444;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    #popularList li:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px var(--shadow-medium);
    }
    
    /* Stil pentru mesajul informativ sub statistici */
    #popularStatsInfo {
        text-align: center;
        font-style: italic;
        color: #888;
        margin-top: 1em;
        font-size: 1em; 
    }


    /* Secțiunea Detalii Produs - ELIMINATĂ din index.html */
    /* Stiluri Modal */
    .modal {
      position: fixed;
      z-index: 1000; 
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.6); 
      display: flex; 
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-out; 
    }

    .modal-content {
      background-color: var(--text-light);
      padding: 35px; 
      border: none; 
      width: 90%;
      max-width: 580px; 
      border-radius: 20px; 
      box-shadow: 0 10px 40px var(--shadow-medium); 
      position: relative;
      animation: slideIn 0.3s ease-out; 
    }

    .close-button {
      color: #999; 
      font-size: 36px; 
      font-weight: bold;
      position: absolute;
      top: 15px;
      right: 20px;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .close-button:hover,
    .close-button:focus {
      color: var(--accent-color); 
    }

    .modal-content h2 {
      text-align: center;
      margin-bottom: 30px;
      color: var(--secondary-color);
      font-family: 'Poppins', sans-serif;
      font-size: 2.3em;
      font-weight: 600;
    }

    .modal-content form {
      display: flex;
      flex-direction: column;
      gap: 20px; 
    }

    .modal-content label {
      font-weight: 600; 
      color: #555;
      margin-bottom: 5px; 
      font-size: 1.05em;
    }

    .modal-content input[type="text"],
    .modal-content input[type="password"],
    .modal-content input[type="number"],
    .modal-content input[type="url"],
    .modal-content select {
      padding: 14px; 
      border: 1px solid var(--border-color);
      border-radius: 12px;
      font-size: 1.05em;
      box-sizing: border-box;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      background-color: #fcfcfc; 
      color: var(--text-dark);
    }

    .modal-content input[type="text"]:focus,
    .modal-content input[type="password"]:focus,
    .modal-content input[type="number"]:focus,
    .modal-content input[type="url"]:focus,
    .modal-content select:focus {
      border-color: var(--secondary-color);
      outline: none;
      box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.3);
    }

    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 20px; 
      margin-top: 30px; 
    }

    .modal-buttons button {
      background-color: var(--secondary-color);
      color: var(--text-light);
      padding: 14px 30px;
      border: none;
      border-radius: 25px; 
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .modal-buttons button:hover {
      background-color: #0056b3;
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }

    #registerSubmit {
        background-color: var(--primary-color);
    }
    #registerSubmit:hover {
        background-color: #3f9442;
    }
    
    /* Stil specific pentru butoanele de submit/update produs */
    #submitProduct, #updateProduct {
         background-color: var(--primary-color); 
    }
    #submitProduct:hover, #updateProduct:hover {
        background-color: #3f9442;
    }


    /* Mesaje de status */
    #statusMessage, #addProductStatusMessage, #editProductStatusMessage {
      text-align: center;
      margin-top: 20px;
      font-weight: 600;
      padding: 12px;
      border-radius: 10px;
      font-size: 1em;
    }

    #statusMessage.success, #addProductStatusMessage.success, #editProductStatusMessage.success {
      color: #155724; 
      background-color: #d4edda; 
      border: 1px solid #c3e6cb;
    }

    #statusMessage.error, #addProductStatusMessage.error, #editProductStatusMessage.error {
      color: #721c24; 
      background-color: #f8d7da; 
      border: 1px solid #f5c6cb;
    }

    /* Animații */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }


    /* Design Responsiv */
    @media (max-width: 992px) {
        #recommendations, #popularList {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
    }

    @media (max-width: 768px) {
      header {
        padding: 1.5em 0.8em;
        gap: 1.2em;
      }

      header h1 {
        font-size: 2.2em;
      }

      .header-actions {
          flex-direction: column; 
          gap: 0.8em;
      }

      #searchInput {
        width: 95%;
        padding: 0.8em 1.2em;
        font-size: 0.95em;
      }

      #filters {
        flex-direction: column; 
        width: 95%;
        gap: 0.8em;
      }

      #filters input, #filters select {
        width: 100%; 
        min-width: unset; 
        padding: 0.7em 1em;
        font-size: 0.9em;
      }

      main {
        padding: 2em 0.8em;
      }

      h2 {
        font-size: 2em;
        margin-bottom: 1.8em;
      }

      #recommendations, #popularList {
        grid-template-columns: 1fr; 
      }

      .device-card {
        padding: 1.5em;
      }

      .device-card h3 {
        font-size: 1.4em;
      }

      .device-card p {
        font-size: 1.05em;
      }

      /* Butoanele de acțiune întotdeauna vizibile pe mobil */
      .device-actions {
          position: static; 
          display: flex !important; 
          justify-content: flex-end; 
          margin-top: 0.5em; 
          gap: 8px;
          padding-bottom: 0.5em; 
          border-bottom: 1px solid var(--border-color); 
      }
      .device-actions button {
          padding: 8px 12px;
          font-size: 0.85em;
          border-radius: 6px;
      }

      /* Secțiunea Detalii Produs - ELIMINATĂ */

      .modal-content {
        padding: 25px;
        width: 95%;
      }

      .modal-content h2 {
        font-size: 2em;
      }

      .modal-content input, .modal-content select {
          padding: 10px;
          font-size: 0.95em;
          border-radius: 10px;
      }
      .modal-buttons {
        flex-direction: column;
        gap: 12px;
      }
      .modal-buttons button {
          width: 100%;
          padding: 12px 20px;
          font-size: 1em;
          border-radius: 12px;
      }
    }

    @media (max-width: 480px) {
      header h1 {
        font-size: 1.8em;
      }

      #authStatus {
          flex-direction: column;
          gap: 6px;
          font-size: 0.95em;
      }

      #loginButton, #logoutButton, #addProductButton {
          width: 100%;
          padding: 10px 15px;
          font-size: 0.95em;
          border-radius: 18px;
      }
      
      #searchInput {
          padding: 0.7em 1em;
          font-size: 0.9em;
          border-radius: 18px;
      }

      #filters input, #filters select {
          padding: 0.6em 0.8em;
          font-size: 0.85em;
          border-radius: 10px;
      }

      h2 {
          font-size: 1.6em;
      }

      .device-card {
          padding: 1em;
      }
      .device-card h3 {
        font-size: 1.1em;
      }
      .device-card p {
        font-size: 0.85em;
      }
      .device-actions button {
          padding: 5px 8px;
          font-size: 0.75em;
      }

      /* Secțiunea Detalii Produs - ELIMINATĂ */

      .modal-content {
          padding: 18px;
      }
      .modal-content h2 {
          font-size: 1.7em;
      }
      .modal-content input, .modal-content select {
          padding: 10px;
          font-size: 0.95em;
          border-radius: 10px;
      }
      .modal-buttons button {
          padding: 10px 15px;
          font-size: 0.95em;
          border-radius: 12px;
      }
      .close-button {
          font-size: 30px;
          top: 10px;
          right: 15px;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="/"> <!-- Adaugat link pe titlu catre homepage -->
        <h1>Recomandări Dispozitive Electronice</h1>
    </a>
    <div class="header-actions">
        <button id="addProductButton" style="display: none;">Adaugă Produs</button>
        <button id="loginButton">Conectare/Înregistrare</button>
        <div id="authStatus" style="display: none;">
            <span id="welcomeMessage"></span>
            <button id="logoutButton" style="display: none;">Deconectare</button>
        </div>
    </div>
    <input type="text" id="searchInput" placeholder="Caută după model sau caracteristici...">
    <div id="filters">
      <input type="number" id="minPrice" placeholder="Preț minim" min="0">
      <input type="number" id="maxPrice" placeholder="Preț maxim" min="0">
      <input type="number" id="batteryLife" placeholder="Autonomie (ore)" min="0">
      <select id="deviceType">
        <option value="">Toate tipurile</option>
        <option value="telefon">Telefon</option>
        <option value="tableta">Tabletă</option>
        <option value="ceas">Ceas</option>
        <option value="drona">Dronă</option>
        <option value="laptop">Laptop</option>
        <option value="casti">Căști</option>
      </select>
    </div>
  </header>

  <main>
    <section id="recommendationsList">
        <div id="recommendations"></div>
    </section>
    
    <section id="popularStats">
      <h2>Statistici populare</h2>
      <ul id="popularList"></ul>
       <!-- Mesaj informativ explicit -->
      <p id="popularStatsInfo" style="text-align: center; font-style: italic; color: #888; margin-top: 1em;">
        Această secțiune necesită un endpoint de backend dedicat pentru statistici populare, care nu este încă implementat în server.js.
      </p>
    </section>

    <!-- Product Detail Section - ELIMINATĂ din index.html -->
  </main>

  <footer>
    <a href="/rss">RSS Feed</a>
  </footer>

  <!-- Login/Register Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close-button login-close-button">×</span>
      <h2>Conectare sau Înregistrare</h2>
      <form id="authForm">
        <label for="username">Nume utilizator:</label>
        <input type="text" id="username" name="username" required>

        <label for="password">Parolă:</label>
        <input type="password" id="password" name="password" required>
        
        <div class="modal-buttons">
          <button type="button" id="loginSubmit">Conectare</button>
          <button type="button" id="registerSubmit">Înregistrare</button>
        </div>
      </form>
      <div id="statusMessage"></div>
    </div>
  </div>

  <!-- Add Product Modal -->
  <div id="addProductModal" class="modal">
    <div class="modal-content">
      <span class="close-button add-product-close-button">×</span>
      <h2>Adaugă Produs Nou</h2>
      <form id="productForm">
        <label for="productNameInput">Nume Produs:</label>
        <input type="text" id="productNameInput" required>

        <label for="productPriceInput">Preț:</label>
        <input type="number" id="productPriceInput" step="0.01" required min="0">

        <label for="productBatteryLifeInput">Autonomie Baterie (ore):</label>
        <input type="number" id="productBatteryLifeInput" min="0">

        <label for="productTypeInput">Tip Produs:</label>
        <select id="productTypeInput" required>
            <option value="">Selectează un tip</option>
            <option value="telefon">Telefon</option>
            <option value="tableta">Tabletă</option>
            <option value="ceas">Ceas</option>
            <option value="drona">Dronă</option>
            <option value="laptop">Laptop</option>
            <option value="casti">Căști</option>
        </select>

        <label for="productFeaturesInput">Caracteristici (separate prin virgulă):</label>
        <input type="text" id="productFeaturesInput" placeholder="Ex: 5G, iOS, Face ID" required>

        <label for="productLinkInput">Link Produs (opțional):</label>
        <input type="url" id="productLinkInput" placeholder="Ex: https://exemplu.com/produs">

        <div class="modal-buttons">
          <button type="submit" id="submitProduct">Adaugă Produs</button>
        </div>
      </form>
      <div id="addProductStatusMessage"></div>
    </div>
  </div>

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <span class="close-button edit-product-close-button">×</span>
            <h2>Editează Produs</h2>
            <form id="editProductForm">
                <input type="hidden" id="editProductId"> 
                
                <label for="editProductNameInput">Nume Produs:</label>
                <input type="text" id="editProductNameInput" required>

                <label for="editProductPriceInput">Preț:</label>
                <input type="number" id="editProductPriceInput" step="0.01" required min="0">

                <label for="editProductBatteryLifeInput">Autonomie Baterie (ore):</label>
                <input type="number" id="editProductBatteryLifeInput" min="0">

                <label for="editProductTypeInput">Tip Produs:</label>
                <select id="editProductTypeInput" required>
                    <option value="">Selectează un tip</option>
                    <option value="telefon">Telefon</option>
                    <option value="tableta">Tabletă</option>
                    <option value="ceas">Ceas</option>
                    <option value="drona">Dronă</option>
                    <option value="laptop">Laptop</option>
                    <option value="casti">Căști</option>
                </select>

                <label for="editProductFeaturesInput">Caracteristici (separate prin virgulă):</label>
                <input type="text" id="editProductFeaturesInput" placeholder="Ex: 5G, iOS, Face ID" required>

                <label for="editProductLinkInput">Link Produs (opțional):</label>
                <input type="url" id="editProductLinkInput" placeholder="Ex: https://exemplu.com/produs">

                <div class="modal-buttons">
                    <button type="submit" id="updateProduct">Actualizează Produs</button>
                </div>
            </form>
            <div id="editProductStatusMessage"></div>
        </div>
    </div>


  <script>
    const recommendationsListSection = document.getElementById('recommendationsList');
    const popularStatsSection = document.getElementById('popularStats');
    const popularStatsInfo = document.getElementById('popularStatsInfo'); 

    // Function to show/hide sections (Not used for multi-page, keeping minimal)
    // function showSection(sectionElement) { /* ... */ } 

    async function fetchRecommendations(query = '') {
      const minPrice = document.getElementById('minPrice').value;
      const maxPrice = document.getElementById('maxPrice').value;
      const batteryLife = document.getElementById('batteryLife').value;
      const deviceType = document.getElementById('deviceType').value;
      const userRole = localStorage.getItem('userRole'); 

      const params = new URLSearchParams({
        q: query,
        minPrice,
        maxPrice,
        batteryLife,
        deviceType
      });

      try { 
          const res = await fetch(`/api/recommendations?${params.toString()}`);
          if (!res.ok) {
              console.error('Failed to fetch recommendations:', res.status, res.statusText);
               document.getElementById('recommendations').innerHTML = '<p class="no-results error">Eroare la încărcarea recomandărilor.</p>';
               return;
          }
          const data = await res.json();
          const container = document.getElementById('recommendations');
          container.innerHTML = '';
          
          if (data.length === 0) {
            container.innerHTML = '<p class="no-results">Nu s-au găsit recomandări conform filtrelor.</p>'; 
            return;
          }
          data.forEach(device => {
            const div = document.createElement('div');
            div.className = 'device-card';
            div.dataset.productId = device.id;

            // Add edit/delete buttons container if user is admin
            if (userRole === 'admin') {
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'device-actions'; 

                const editButton = document.createElement('button');
                editButton.textContent = 'Editează';
                editButton.className = 'edit-btn';
                editButton.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    openEditProductModal(device.id);
                });

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Șterge';
                deleteButton.className = 'delete-btn';
                deleteButton.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    if (confirm('Ești sigur că vrei să ștergi acest produs?')) {
                        deleteProduct(device.id);
                    }
                });

                actionsDiv.appendChild(editButton);
                actionsDiv.appendChild(deleteButton);
                // Inserăm div-ul de acțiuni la începutul cardului
                div.insertBefore(actionsDiv, div.firstChild);
            }
            
            // Adăugăm restul conținutului cardului (h3 and p elements)
            const contentHTML = `
              <h3>${device.name}</h3>
              <p>Preț: ${device.price} Lei</p>
              <p>Caracteristici: ${device.features.join(', ')}</p>
            `;
             // Creăm elemente HTML din string și le adăugăm la div
             const tempDiv = document.createElement('div');
             tempDiv.innerHTML = contentHTML;
             while(tempDiv.firstChild) {
                 div.appendChild(tempDiv.firstChild);
             }


            // NOU: Navigare la pagina de detalii la click pe card (dacă nu e pe un buton)
            div.addEventListener('click', (e) => {
                if (!e.target.closest('.device-actions button')) {
                     window.location.href = `/product-details.html?product_id=${device.id}`;
                }
            });
            container.appendChild(div);
          });
      } catch (error) {
           console.error('Error fetching recommendations:', error);
           document.getElementById('recommendations').innerHTML = '<p class="no-results error">A apărut o eroare la încărcarea recomandărilor.</p>';
      }
    }

    // Function to display single product details (ELIMINATĂ din index.html)
    // async function displayProductDetails(productId) { /* ... */ }
    
    // Fetch popular statistics
    async function fetchPopularStats() {
        const popularList = document.getElementById('popularList');
        popularList.innerHTML = ''; 
        if (popularStatsInfo) { 
           popularStatsInfo.style.display = 'block'; 
        }

        try {
            const res = await fetch('/api/popular'); 
            if (res.ok) {
                const popularData = await res.json();
                if (popularData && popularData.length > 0) {
                    popularList.innerHTML = ''; 
                    if (popularStatsInfo) { popularStatsInfo.style.display = 'none'; }
                    popularData.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.name || item.model || item.type} (${item.views || item.count} vizualizări)`; 
                        popularList.appendChild(li);
                    });
                } else {
                    popularList.innerHTML = '<li>Nu sunt statistici populare disponibile.</li>';
                    if (popularStatsInfo) { popularStatsInfo.style.display = 'none'; } 
                }
            } else {
                console.warn('Endpoint /api/popular not found or returned error:', res.status, res.statusText);
                 popularList.innerHTML = '<li>Nu sunt statistici populare disponibile momentan.</li>'; 
                 if (popularStatsInfo) { popularStatsInfo.style.display = 'block'; } 
            }
        } catch (error) {
            console.error('Error fetching popular stats:', error);
            popularList.innerHTML = '<li>A apărut o eroare la încărcarea statisticilor populare.</li>'; 
            if (popularStatsInfo) { popularStatsInfo.style.display = 'block'; } 
        }
    }

    // Event listener pentru butonul "Înapoi la Recomandări" (ELIMINAT din index.html, devine link simplu in footer)
    // backToRecommendationsButton.addEventListener('click', () => { /* ... */ });

    // Trigger fetchRecommendations and fetchPopularStats on page load
    //handleInitialRoute(); // Replaced by direct calls below for simplicity in multi-page index
    fetchRecommendations(document.getElementById('searchInput').value);
    fetchPopularStats();


    // Search and Filter listeners (MODIFIED to not handle detail view navigation)
    document.getElementById('searchInput').addEventListener('input', () => {
      // No check for productDetailsSection needed here anymore
      fetchRecommendations(document.getElementById('searchInput').value);
    });

    document.querySelectorAll('#filters input[type="number"]').forEach(el => { 
      el.addEventListener('input', function() { 
          if (this.valueAsNumber < 0) {
              this.value = 0; 
          }
           // Trigger filter fetch after validation
           // No check for productDetailsSection needed here anymore
           fetchRecommendations(document.getElementById('searchInput').value);
      });
    });

     document.querySelectorAll('#filters select').forEach(el => { 
       el.addEventListener('input', function() { 
           // Trigger filter fetch for selects
           // No check for productDetailsSection needed here anymore
           fetchRecommendations(document.getElementById('searchInput').value);
       });
     });


    // --- Logica Modalului de Login/Înregistrare ---
    const loginButton = document.getElementById('loginButton');
    const logoutButton = document.getElementById('logoutButton'); 
    const loginModal = document.getElementById('loginModal');
    const closeLoginButton = document.querySelector('.login-close-button');
    const loginSubmitButton = document.getElementById('loginSubmit');
    const registerSubmitButton = document.getElementById('registerSubmit');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const statusMessageDiv = document.getElementById('statusMessage');
    const authStatusDiv = document.getElementById('authStatus');
    const welcomeMessageSpan = document.getElementById('welcomeMessage');

    let tokenExpiryCheckInterval; 

    // Afișează modalul de login
    loginButton.addEventListener('click', () => {
      loginModal.style.display = 'flex';
      statusMessageDiv.textContent = '';
      statusMessageDiv.className = '';
      usernameInput.value = ''; 
      passwordInput.value = '';
    });

    // Ascunde modalul de login
    closeLoginButton.addEventListener('click', () => {
      loginModal.style.display = 'none';
    });

    // Ascunde modalul de login dacă se face click în afara conținutului său
    window.addEventListener('click', (event) => {
      if (event.target == loginModal) {
        loginModal.style.display = 'none';
      }
    });

    // Funcție pentru afișarea mesajelor de status pentru login/înregistrare
    function showAuthStatusMessage(message, type) {
      statusMessageDiv.textContent = message;
      statusMessageDiv.className = type;
    }

    // Funcție pentru decodificarea JWT pentru a obține timpul de expirare (exp)
    function decodeJwt(token) {
        try {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        } catch (e) {
            console.error("Failed to decode JWT:", e);
            return null;
        }
    }

    // Funcție pentru verificarea expirării token-ului
    function checkTokenExpiry() {
        const token = localStorage.getItem('token');
        if (token) {
            const decodedToken = decodeJwt(token);
            if (decodedToken && decodedToken.exp) {
                const currentTime = Date.now() / 1000;
                if (decodedToken.exp < currentTime) {
                    console.log("Token expired. Logging out...");
                    logoutUser();
                    return;
                }
            }
        }
        // If token is not present or already handled, clear interval
        if (!token && tokenExpiryCheckInterval) {
             clearInterval(tokenExpiryCheckInterval);
             tokenExpiryCheckInterval = null;
        }
    }

    // Actualizează UI-ul în funcție de statusul autentificării (inclusiv butonul de admin)
    function updateAuthUI() {
      const token = localStorage.getItem('token');
      const role = localStorage.getItem('userRole');
      const username = localStorage.getItem('username');
      const addProductButton = document.getElementById('addProductButton');

      if (tokenExpiryCheckInterval) {
          clearInterval(tokenExpiryCheckInterval);
          tokenExpiryCheckInterval = null;
      }

      if (token && role && username) {
        loginButton.style.display = 'none';
        authStatusDiv.style.display = 'flex';
        welcomeMessageSpan.textContent = `Bine ai venit, ${username} (${role})!`;
        logoutButton.style.display = 'block';

        if (role === 'admin') {
            addProductButton.style.display = 'block';
        } else {
            addProductButton.style.display = 'none';
        }

        tokenExpiryCheckInterval = setInterval(checkTokenExpiry, 5000); 
      } else {
        loginButton.style.display = 'block';
        authStatusDiv.style.display = 'none';
        welcomeMessageSpan.textContent = '';
        logoutButton.style.display = 'none';
        addProductButton.style.display = 'none';
      }
      // Re-încarcă recomandările pentru a aplica controalele de admin pe cardurile de produs
      fetchRecommendations(document.getElementById('searchInput').value);
    }

    // Funcție de login
    loginSubmitButton.addEventListener('click', async (event) => {
      event.preventDefault();
      const username = usernameInput.value;
      const password = passwordInput.value;

      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ username, password }),
        });

        const data = await response.json();

        if (response.ok) {
          showAuthStatusMessage(data.message, 'success');
          localStorage.setItem('token', data.token);
          localStorage.setItem('userRole', data.role);
          localStorage.setItem('username', data.username);
          updateAuthUI();
          setTimeout(() => {
            loginModal.style.display = 'none';
          }, 1500);
        } else {
          showAuthStatusMessage(data.message || 'Eroare la conectare.', 'error');
        }
      } catch (error) {
        console.error('Eroare la conectare:', error);
        showAuthStatusMessage('Eroare la conectare. Vă rugăm să încercați din nou.', 'error');
      }
    });

    // Funcție de înregistrare
    registerSubmitButton.addEventListener('click', async (event) => {
      event.preventDefault();
      const username = usernameInput.value;
      const password = passwordInput.value;

      const minLength = 6;
      const hasUppercase = /[A-Z]/.test(password);
      const hasDigit = /\d/.test(password);

      if (password.length < minLength) {
        showAuthStatusMessage(`Parola trebuie să aibă minim ${minLength} caractere.`, 'error');
        return;
      }
      if (!hasUppercase) {
        showAuthStatusMessage('Parola trebuie să conțină cel puțin o literă mare.', 'error');
        return;
      }
      if (!hasDigit) {
        showAuthStatusMessage('Parola trebuie să conțină cel puțin o cifră.', 'error');
        return;
      }

      try {
        const response = await fetch('/api/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ username, password }),
        });

        const data = await response.json();

        if (response.ok) {
          showAuthStatusMessage(data.message, 'success');
        } else {
          showAuthStatusMessage(data.message || 'Eroare la înregistrare.', 'error');
        }
      } catch (error) {
        console.error('Eroare la înregistrare:', error);
        showAuthStatusMessage('Eroare la înregistrare. Vă rugăm să încercați din nou.', 'error');
      }
    });

    // Funcție de logout
    function logoutUser() {
      localStorage.removeItem('token');
      localStorage.removeItem('userRole');
      localStorage.removeItem('username');
      if (tokenExpiryCheckInterval) {
          clearInterval(tokenExpiryCheckInterval);
          tokenExpiryCheckInterval = null; 
      }
      updateAuthUI();
      // Rămâne pe homepage, doar UI-ul se actualizează
      fetchRecommendations(); // Reîncarcă lista pentru a ascunde butoanele admin
      fetchPopularStats(); 
    }
    // Event listener pentru noul buton de Deconectare
    logoutButton.addEventListener('click', logoutUser);

    // --- Logica Modalului de Adăugare Produs ---
    const addProductModal = document.getElementById('addProductModal');
    const closeAddProductButton = document.querySelector('.add-product-close-button');
    const submitProductButton = document.getElementById('submitProduct');
    const productNameInput = document.getElementById('productNameInput');
    const productPriceInput = document.getElementById('productPriceInput');
    const productBatteryLifeInput = document.getElementById('productBatteryLifeInput');
    const productTypeInput = document.getElementById('productTypeInput');
    const productFeaturesInput = document.getElementById('productFeaturesInput');
    const productLinkInput = document.getElementById('productLinkInput');
    const addProductStatusMessageDiv = document.getElementById('addProductStatusMessage');

    // Afișează modalul de adăugare produs
    document.getElementById('addProductButton').addEventListener('click', () => {
      addProductModal.style.display = 'flex';
      addProductStatusMessageDiv.textContent = '';
      addProductStatusMessageDiv.className = '';
      document.getElementById('productForm').reset(); 
    });

    // Ascunde modalul de adăugare produs
    closeAddProductButton.addEventListener('click', () => {
      addProductModal.style.display = 'none';
    });

    // Ascunde modalul de adăugare produs dacă se face click în afara conținutului său
    window.addEventListener('click', (event) => {
      if (event.target == addProductModal) {
        addProductModal.style.display = 'none';
      }
    });

    // Funcție pentru afișarea mesajelor de status pentru forma de adăugare produs
    function showAddProductStatusMessage(message, type) {
        addProductStatusMessageDiv.textContent = message;
        addProductStatusMessageDiv.className = type;
    }

    // Trimite produsul nou
    submitProductButton.addEventListener('click', async (event) => {
        event.preventDefault();

        const name = productNameInput.value.trim();
        const price = parseFloat(productPriceInput.value);
        const batteryLife = productBatteryLifeInput.value ? parseInt(productBatteryLifeInput.value, 10) : null;
        const type = productTypeInput.value;
        const features = productFeaturesInput.value.split(',').map(f => f.trim()).filter(f => f.length > 0);
        const link = productLinkInput.value.trim();

        // Validare frontend pentru forma de adăugare produs
        if (!name || isNaN(price) || price <= 0 || !type || features.length === 0) {
            showAddProductStatusMessage('Vă rugăm să completați toate câmpurile obligatorii: Nume, Preț valid (>0), Tip și cel puțin o Caracteristică.', 'error');
            return;
        }

        const token = localStorage.getItem('token');
        if (!token) {
            showAddProductStatusMessage('Nu sunteți autentificat. Vă rugăm să vă conectați ca administrator.', 'error');
            return;
        }

        try {
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ name, price, batteryLife, type, features, link })
            });

            const data = await response.json();

            if (response.ok) {
                showAddProductStatusMessage(data.message, 'success');
                document.getElementById('productForm').reset();
                fetchRecommendations(); 
                fetchPopularStats(); 
                setTimeout(() => {
                    addProductModal.style.display = 'none';
                }, 1500);
            } else {
                showAddProductStatusMessage(data.message || 'Eroare la adăugarea produsului.', 'error');
            }
        } catch (error) {
            console.error('Eroare la adăugarea produsului:', error);
            showAddProductStatusMessage('A apărut o eroare la trimiterea datelor. Vă rugăm să încercați din nou.', 'error');
        }
    });

    // --- Logica Modalului de Editare Produs ---
    const editProductModal = document.getElementById('editProductModal');
    const closeEditProductButton = document.querySelector('.edit-product-close-button');
    const updateProductButton = document.getElementById('updateProduct');
    const editProductIdInput = document.getElementById('editProductId');
    const editProductNameInput = document.getElementById('editProductNameInput');
    const editProductPriceInput = document.getElementById('editProductPriceInput');
    const editProductBatteryLifeInput = document.getElementById('editProductBatteryLifeInput');
    const editProductTypeInput = document.getElementById('editProductTypeInput');
    const editProductFeaturesInput = document.getElementById('editProductFeaturesInput');
    const editProductLinkInput = document.getElementById('editProductLinkInput');
    const editProductStatusMessageDiv = document.getElementById('editProductStatusMessage');

    // Funcție pentru afișarea mesajelor de status pentru forma de editare produs
    function showEditProductStatusMessage(message, type) {
        editProductStatusMessageDiv.textContent = message;
        editProductStatusMessageDiv.className = type;
    }

    // Deschide modalul de editare produs și completează cu date
    async function openEditProductModal(productId) {
        editProductStatusMessageDiv.textContent = '';
        editProductStatusMessageDiv.className = '';
        
        try {
            const userRole = localStorage.getItem('userRole');
            const token = localStorage.getItem('token');
            if (userRole !== 'admin' || !token) {
                 alert('Nu aveți permisiunea de a edita produse.'); 
                 return;
            }

            const res = await fetch(`/api/products/${productId}`, {
                 headers: {
                    'Authorization': `Bearer ${token}` 
                 }
            });
            const product = await res.json();

            if (res.ok) {
                editProductIdInput.value = product.id;
                editProductNameInput.value = product.name;
                editProductPriceInput.value = product.price;
                editProductBatteryLifeInput.value = product.batterylife || ''; 
                editProductTypeInput.value = product.type;
                editProductFeaturesInput.value = product.features.join(', ');
                editProductLinkInput.value = product.link && product.link !== 'null' ? product.link : ''; 

                editProductModal.style.display = 'flex';
            } else {
                showEditProductStatusMessage(product.message || `Eroare la preluarea datelor produsului (Status: ${res.status}).`, 'error');
                 editProductModal.style.display = 'none'; 
            }
        } catch (error) {
            console.error('Error fetching product for edit:', error);
            showEditProductStatusMessage('A apărut o eroare la încărcarea datelor produsului pentru editare. Verificați conexiunea și autentificarea.', 'error');
             editProductModal.style.display = 'none'; 
        }
    }

    // Ascunde modalul de editare produs
    closeEditProductButton.addEventListener('click', () => {
      editProductModal.style.display = 'none';
    });

    // Ascunde modalul de editare produs dacă se face click în afara conținutului său
    window.addEventListener('click', (event) => {
      if (event.target == editProductModal) {
        editProductModal.style.display = 'none';
      }
    });

    // Trimite produsul actualizat
    updateProductButton.addEventListener('click', async (event) => {
        event.preventDefault();

        const productId = editProductIdInput.value;
        const name = editProductNameInput.value.trim();
        const price = parseFloat(editProductPriceInput.value);
        const batteryLife = editProductBatteryLifeInput.value ? parseInt(editProductBatteryLifeInput.value, 10) : null;
        const type = editProductTypeInput.value;
        const features = editProductFeaturesInput.value.split(',').map(f => f.trim()).filter(f => f.length > 0);
        const link = editProductLinkInput.value.trim();

        // Validare frontend pentru forma de editare produs
         if (!productId || !name || isNaN(price) || price <= 0 || !type || features.length === 0) {
            showEditProductStatusMessage('Vă rugăm să completați toate câmpurile obligatorii: Nume, Preț valid (>0), Tip și cel puțin o Caracteristică.', 'error');
            return;
        }


        const token = localStorage.getItem('token');
        if (!token) {
            showEditProductStatusMessage('Nu sunteți autentificat. Vă rugăm să vă conectați ca administrator.', 'error');
            return;
        }

        try {
            const response = await fetch(`/api/products/${productId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` 
                },
                body: JSON.stringify({ name, price, batteryLife, type, features, link })
            });

            const data = await response.json();

            if (response.ok) {
                showEditProductStatusMessage(data.message, 'success');
                fetchRecommendations(); 
                fetchPopularStats(); 
                // Afișează detaliile produsului actualizat dacă utilizatorul era pe acea pagină
                // Logica asta nu mai e necesara in index.html, deoarece detalii sunt pe alta pagina
                // const urlParams = new URLSearchParams(window.location.search);
                // if (urlParams.get('product_id') === productId.toString()) {
                //     displayProductDetails(productId); 
                // }

                setTimeout(() => {
                    editProductModal.style.display = 'none';
                }, 1500);
            } else {
                showEditProductStatusMessage(data.message || `Eroare la actualizarea produsului (Status: ${response.status}).`, 'error');
            }
        } catch (error) {
            console.error('Eroare la actualizarea produsului:', error);
            showEditProductStatusMessage('A apărut o eroare la trimiterea datelor de actualizare. Verificați conexiunea și autentificarea.', 'error');
        }
    });

    // Funcție pentru Ștergere Produs
    async function deleteProduct(productId) {
        const token = localStorage.getItem('token');
        const userRole = localStorage.getItem('userRole'); 
        
        if (userRole !== 'admin' || !token) { 
            alert('Nu aveți permisiunea de a șterge produse. Vă rugăm să vă conectați ca administrator.'); 
            return;
        }

        if (!confirm('Ești sigur că vrei să ștergi acest produs?')) {
             return; 
        }


        try {
            const response = await fetch(`/api/products/${productId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}` 
                }
            });

            const data = await response.json();

            if (response.ok) {
                alert(data.message); 
                fetchRecommendations(); 
                fetchPopularStats(); 

                 // Daca stergi de pe homepage, nu navighezi. Daca stergi de pe pagina de detalii (nu e implementat aici), ar trebui sa te intorci la lista.
                 // Logica asta nu mai e necesara in index.html
                 // const urlParams = new URLSearchParams(window.location.search);
                 // if (urlParams.get('product_id') === productId.toString()) {
                 //    window.history.pushState(null, '', '/');
                 //    showSection(recommendationsListSection);
                 // }

            } else {
                alert(data.message || `Eroare la ștergerea produsului (Status: ${response.status}).`); 
            }
        } catch (error) {
            console.error('Eroare la ștergerea produsului:', error);
            alert('A apărut o eroare la ștergerea produsului. Verificați conexiunea și autentificarea.'); 
        }
    }

    // Actualizare UI inițială la încărcarea paginii
    updateAuthUI();
  </script>
</body>
</html>